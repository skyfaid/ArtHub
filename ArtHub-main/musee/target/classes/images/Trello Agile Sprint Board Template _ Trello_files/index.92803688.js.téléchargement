function e(e){return e&&e.__esModule?e.default:e}var t=globalThis,i={},r={},l=t.parcelRequiree178;null==l&&((l=function(e){if(e in i)return i[e].exports;if(e in r){var t=r[e];delete r[e];var l={id:e,exports:{}};return i[e]=l,t.call(l.exports,l,l.exports),l.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){r[e]=t},t.parcelRequiree178=l);var o=l.register;o("3g3li",function(e,t){e.exports={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/9aa3336a68d8/{locale}.json"}}),o("5H6Fu",function(e,t){let i=["http://localhost:2999/","http://localhost:3002/"];e.exports={getTargetOrigin:()=>{var e;return i.includes(null===(e=document)||void 0===e?void 0:e.referrer)?document.referrer:"https://trello.com".toString()}}});var a=(l("52TBR"),l("52TBR"));const n=/^https?:\/\/(?:[\w-]+\.)?(?:app\.)?box\.com\//,d=e=>n.test(e),u=e=>{var t,i;let r={url:e};if(!d(e))return r;r.isBox=!0;let l=null===(t=e.replace(n,"").replace(/#.*$/,"").split("?")[0])||void 0===t?void 0:t.split("/");return l&&("s"===l[0]?(r.isShareLink=!0,/\?folder=true$/.test(e)?r.isFolder=!0:/\?folder=false$/.test(e)&&(r.isFile=!0)):"files"===l[0]?l.length<6&&l.length>3&&"f"===l[2]?(r.isFolder=!0,r.folderId=l[3]||""):l.length>5&&(null===(i=l[5])||void 0===i?void 0:i.indexOf("f_"))===0&&(r.isFile=!0,r.fileId=l[5].substring(2)):"file"===l[0]?(r.isFile=!0,r.fileId=l[1]||""):"folder"===l[0]&&(r.isFolder=!0,r.folderId=l[1]||"")),r},m=(e,t)=>{let i=u(t);return!!i.isFolder||!i.isFile&&!!i.isShareLink&&(0,a.getSharedItem)(e,t,{fields:"type"}).then(e=>"folder"===e.type)},{Promise:s}=window.TrelloPowerUp,f=(e,t,i)=>{try{let r=u(t);if(!r.isBox)throw e.NotHandled("not a box url");if(r.isFile&&r.fileId)return s.all([(0,a.getFile)(e,{id:r.fileId,fields:"id,name,type,created_at,modified_at,modified_by,size"}),s.try(()=>i.thumbnail?(0,a.getThumbnail)(e,r.fileId):"")]).then(([e,i])=>{var r;return{image:{url:i,y:"top",size:"contain"},id:e.id,title:e.name,name:e.name,created_at:e.created_at,modified_at:e.modified_at,modified_by:{name:null===(r=e.modified_by)||void 0===r?void 0:r.name},size:e.size,type:"file",url:t}});if(r.isFolder&&r.folderId)return(0,a.getFolder)(e,{id:r.folderId,fields:"id,name,type,created_at,modified_at,modified_by,size"}).then(e=>{var i;return{title:e.name,name:e.name,created_at:e.created_at,modified_at:e.modified_at,modified_by:{name:null===(i=e.modified_by)||void 0===i?void 0:i.name},id:e.id,size:e.size,type:"folder",url:t}});if(r.isShareLink){let l=r.url.replace("?folder=true","").replace("?folder=false","");return(0,a.getSharedItem)(e,l,{fields:"id,name,type,created_at,modified_at,modified_by,size,type"}).then(r=>s.try(()=>"type"in r&&"file"===r.type&&i.thumbnail?(0,a.getThumbnail)(e,r.id,l):"").then(e=>{var i;return{image:{url:e,y:"top",size:"contain"},name:r.name,title:r.name,created_at:r.created_at,modified_at:r.modified_at,modified_by:{name:null===(i=r.modified_by)||void 0===i?void 0:i.name},id:r.id,size:r.size,type:r.type,url:t}}).catch(()=>{var e;return{name:r.name,title:r.name,created_at:r.created_at,modified_at:r.modified_at,modified_by:{name:null===(e=r.modified_by)||void 0===e?void 0:e.name},id:r.id,size:r.size,type:r.type,url:t}}))}throw e.NotHandled("box url formatting error")}catch(t){throw e.NotHandled("not a box url")}};var c={};c=e=>{let t=[" Bytes"," KB"," MB"," GB"," TB"," PB"];for(let i=1;i<t.length;i++)if(e<1024**i)return Math.round(e/1024**(i-1)*100)/100+t[i-1];return e};const h=e=>e.popup({title:e.localizeKey("box"),url:"./attach.html",height:30});var p=l("fJ7bP"),g=l("3g3li"),y=l("5H6Fu");const{Promise:_}=window.TrelloPowerUp,b="./images/icon.svg",x=e=>{let t=new Map;return e.filter(e=>!t.has(e.url)&&(t.set(e.url,!0),!0))};window.TrelloPowerUp.initialize({"attachment-sections":(e,t)=>{let{entries:i}=t;return _.filter(i,t=>m(e,t.url)).then(t=>0===t.length?[]:_.map(x(t),t=>{let i=f(e,t.url,{thumbnail:t.name||!0}).then(t=>t.title&&!/^https:/.test(t.title)?t.title:e.localizeKey("box_folder")).catch(p.BoxError,()=>t.name&&!/^https?:/.test(t.name)?t.name:e.localizeKey("box_folder"));return{id:t.id,claimed:[t],icon:b,title:()=>i,content:{type:"iframe",url:e.signUrl("./folder.html",{url:t.url}),height:480}}})).catch(p.BoxError,()=>[])},"attachment-thumbnail":(e,t)=>f(e,t.url,{thumbnail:!0}).then(i=>{if(!i)throw new p.BoxError.Unknown;return i.image&&i.image.url||(i.image={url:b,logo:!0}),i.url=t.url,i.openText=e.localizeKey("open_in_box"),i}).catch(p.BoxError.Unauthorized,p.BoxError.CouldNotRefresh,()=>({image:{url:b,logo:!0},url:t.url,title:t.name||t.url,openText:e.localizeKey("open_in_box"),initialize:{type:"iframe",url:e.signUrl(window.TrelloPowerUp.util.relativeUrl("authorize-link.html"))}})).catch(p.BoxError,()=>{if(d(t.url))return{image:{url:b,logo:!0},url:t.url,title:t.name||t.url,openText:e.localizeKey("open_in_box")};throw e.NotHandled()}),"card-buttons":e=>e.memberCanWriteToModel("card")?[{icon:b,text:e.localizeKey("box"),callback:h}]:[],"format-url":async(t,i)=>{if(!d(i.url||""))throw t.NotHandled("Not a formattable URL");try{let{title:r,image:l,type:o,size:a}=await f(t,i.url,{thumbnail:!0}),n=e(c)(a);return"folder"===o&&(n=0===a?t.localizeKey("empty_folder"):`${t.localizeKey("folder")} ${e(c)(a)}`),{icon:b,text:r,subtext:n,...(null==l?void 0:l.url)?{image:l}:{}}}catch(e){if(e instanceof p.BoxError&&d(i.url))return{icon:b,text:i.name||i.url};throw t.NotHandled()}}},{targetOrigin:(0,y.getTargetOrigin)(),localization:e(g),Sentry:window.Sentry});
//# sourceMappingURL=index.92803688.js.map
