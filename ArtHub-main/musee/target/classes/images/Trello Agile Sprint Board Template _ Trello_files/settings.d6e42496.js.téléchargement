function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r=globalThis,i={},s={},n=r.parcelRequired932;null==n&&((n=function(e){if(e in i)return i[e].exports;if(e in s){var t=s[e];delete s[e];var r={id:e,exports:{}};return i[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){s[e]=t},r.parcelRequired932=n);var o=n.register;o("hWx02",function(t,r){e(t.exports,"sendUIEvent",()=>p);var i=n("72fTH"),s=n("hKBww"),o=n("e5i1Q");let a=["slackTrelloPowerUp"],c=window.navigator.userAgent.includes("TrelloDesktop"),{env:l,apiHost:u}=function(){switch(o.environment){case"production":return{env:s.envType.PROD,apiHost:"trello.com/gateway/api/gasv3/api/v1"};case"staging":return{env:s.envType.STAGING,apiHost:"trellis.coffee/gateway/api/gasv3/api/v1"};case"local":return{env:s.envType.LOCAL,apiHost:"trellis.coffee/gateway/api/gasv3/api/v1"};default:throw Error(`Unknown environment ${o.environment}`)}}(),d=new i.default({env:l,product:"trello",version:o.version,origin:c?s.originType.DESKTOP:s.originType.WEB,platform:c?function(){let{platform:e}=window.navigator;if(e){if(e.includes("Win"))return s.platformType.WINDOWS;if(e.includes("Linux"))return s.platformType.LINUX;if(e.includes("Mac"))return s.platformType.MAC}}():s.platformType.WEB,locale:window.navigator.language},{apiHost:u});d.setTenantInfo(s.tenantType.NONE);let h=!1;function p(e,t){!function(e,t,r){try{!function(e){if(h)return;let t=e.getContext().member;d.setUserInfo(s.userType.TRELLO,t),h=!0}(t);let i=function(e){let t=e.getContext();return["card","board","organization","enterprise"].reduce((e,r)=>t[r]?{...e,[r]:{id:t[r]}}:e,{})}(t);if(i.organization?.id){let e=`ari:cloud:trello::workspace/${i.organization.id}`;d.setWorkspaceInfo(e)}r({...e,containers:i,tags:a})}catch(e){// eslint-disable-next-line no-console
console.warn("Failed to send analytic event",e)}}(e,t,d.sendUIEvent)}}),o("72fTH",function(r,i){e(r.exports,"default",()=>P);var s=n("i5ijL"),o=n("dZz5i"),a=n("hKBww"),c=n("4Q3vo"),l=n("3zP8R"),u=n("b62iB"),d=n("gJ6s6"),h=n("3ZQ32"),p=n("c3xvq"),f=n("bzD9k"),m=n("aSWoh"),y=n("hl9hC"),g=n("5t8ho"),v=n("lRK9J"),I=n("csiQo"),b=n("9EU5K"),E=n("9Vwtv"),O=n("9KrVO"),T=n("9U1aK"),w=n("krz7b");function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function S(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?_(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let A="last.screen.event";class P{constructor(e,r={}){if(/*@__PURE__*/t(s)(this,"_useStargate",e=>null==e||e),/*@__PURE__*/t(s)(this,"_selectHost",({useStargate:e,env:t,useLegacyUrl:r,perimeter:i})=>e?r?i===a.perimeterType.FEDRAMP_MODERATE&&t===a.envType.STAGING?"api-private.atlassian-fex.com/gasv3/api/v1":t===a.envType.PROD?"api-private.atlassian.com/gasv3/api/v1":"api-private.stg.atlassian.com/gasv3/api/v1":window.location.host+"/gateway/api/gasv3/api/v1":i===a.perimeterType.FEDRAMP_MODERATE&&t===a.envType.STAGING?"as.atlassian-fex.com/api/v1":t===a.envType.PROD?"as.atlassian.com/api/v1":"as.staging.atl-paas.net/api/v1"),/*@__PURE__*/t(s)(this,"_endsWith",(e,t)=>-1!==e.indexOf(t,e.length-t.length)),/*@__PURE__*/t(s)(this,"_changeInternalUserId",(e,t)=>{this.eventProcessor.getUser().setUserId(e),t&&t!==this.eventProcessor.getUser().getAnonymousId()&&// Only update if it has changed.
this.eventProcessor.getUser().setAnonymousId(t)}),/*@__PURE__*/t(s)(this,"_createSubproductGetter",e=>(0,l.default)(e,"Cannot get subproduct from the callback. Proceeding without it.")),/*@__PURE__*/t(s)(this,"_createEmbeddedProductGetter",e=>(0,l.default)(e,"Cannot get embeddedProduct from the callback. Proceeding without it.")),/*@__PURE__*/t(s)(this,"_getLastScreenEvent",()=>{try{return JSON.parse(this._safeSessionStorage.getItem(A)||"")}catch(e){return this._safeSessionStorage.removeItem(A),null}}),/*@__PURE__*/t(s)(this,"_setLastScreenEvent",e=>{this._safeSessionStorage.setItem(A,JSON.stringify({name:e.name,attributes:e.attributes}))}),/*@__PURE__*/t(s)(this,"_shouldEventBeDelayed",e=>{// TODO: this is a temporary restriction for the purposes of the Track All Changes project
// The delay mechanism has a chance of event loss, which we can only accept for our own data at this point.
// Once the delay queue implementation has been improved and measured to confirm that it is reliable enough,
// then we will be able to open it up for other products to use by removing this check.
if(!e.tags||-1===e.tags.indexOf("measurement"))return!1;let t=!1!==e.highPriority;// defaults to true if excluded
return this.eventDelayQueue.isDelayingLowPriorityEvents()&&!t}),/*@__PURE__*/t(s)(this,"_fireEvent",(e,t,r,i)=>{switch(t.eventType){case a.eventType.UI:case a.eventType.OPERATIONAL:case a.eventType.TRACK:return this.eventProcessor.track(e,t,r,i);case a.eventType.SCREEN:return this.eventProcessor.page(e,t,r,i);case a.eventType.IDENTIFY:return this.eventProcessor.identify(e,t,r,i);default:throw Error(`No handler has been defined for events of type ${t.eventType}`)}}),/*@__PURE__*/t(s)(this,"_fireDelayedEvent",(e,t,r,i)=>{try{// User information can change while the delay period is active, so we need to restore the values that
// were active when the event was originally fired.
this._changeInternalUserId(i.userId,i.anonymousId),t.tags=[...t.tags||[],"sentWithDelay"],// The callbacks for delayed events are fired immediately, so there is nothing to pass through for this argument.
this._fireEvent(e,t,r,void 0)}finally{this._changeInternalUserId(this._userInfo.userId,this._userInfo.anonymousId)}}),/*@__PURE__*/t(s)(this,"_delayEvent",(e,t,r,i,s)=>{this.eventDelayQueue.push(e,t,r,i),s&&s()}),/*@__PURE__*/t(s)(this,"_processEvent",(e,t,r,i)=>(this._testingCache.saveEvent(t),this._shouldEventBeDelayed(t))?(this._delayEvent(e,t,r,this._userInfo,i),Promise.resolve()):this._fireEvent(e,t,r,i)),/*@__PURE__*/t(s)(this,"setEmbeddedProduct",e=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(e),this.resetUIViewedTimers()}),/*@__PURE__*/t(s)(this,"clearEmbeddedProduct",()=>{this._productInfo.embeddedProduct=this._createEmbeddedProductGetter(null)}),/*@__PURE__*/t(s)(this,"setSubproduct",e=>{this._productInfo.subproduct=this._createSubproductGetter(e),this.resetUIViewedTimers()}),/*@__PURE__*/t(s)(this,"setOriginTracingHandlers",e=>{let t=this.originTracing.handleOriginParameters(e,this._historyReplaceFn);Object.keys(t).forEach(e=>{void 0!==t[e].taskSessionId&&this.task.createTaskSessionWithProvidedId(e,t[e].taskSessionId)});let r={};return(Object.keys(t).forEach(e=>{t[e].originTracingAttributes?r[e]=t[e].originTracingAttributes:console.warn(`Handling method for origin parameter ${e} has not returned any attributes`)}),Object.keys(t).length>0)?this.sendOperationalEvent({action:"landed",actionSubject:"origin",source:"webClient",attributes:{originTracesLanded:r}},()=>{}):Promise.resolve()}),/*@__PURE__*/t(s)(this,"setTenantInfo",(e,t)=>{if(!e)throw Error("Missing tenantIdType");if(e!==a.tenantType.NONE&&!t)throw Error("Missing tenantId");if(!(0,a.isType)(a.tenantType,e))throw Error(`Invalid tenantIdType '${e}', must be an tenantType: [${(0,a.objectValues)(a.tenantType)}]`);this._tenantInfo={tenantIdType:e,tenantId:t}}),/*@__PURE__*/t(s)(this,"clearTenantInfo",()=>{this._tenantInfo={}}),/*@__PURE__*/t(s)(this,"setOrgInfo",e=>{if(!e)throw Error("Missing orgId");this._orgInfo={orgId:e}}),/*@__PURE__*/t(s)(this,"clearOrgInfo",()=>{this._orgInfo={}}),/*@__PURE__*/t(s)(this,"setWorkspaceInfo",e=>{if(!e)throw Error("Missing workspaceId");this._workspaceInfo={workspaceId:e}}),/*@__PURE__*/t(s)(this,"clearWorkspaceInfo",()=>{this._workspaceInfo={}}),/*@__PURE__*/t(s)(this,"setUserInfo",(e,t)=>{(0,h.validateIdentifyEvent)(e,t),this._changeInternalUserId(t),this._userInfo={userIdType:e,userId:t,anonymousId:this.eventProcessor.getUser().getAnonymousId()}}),/*@__PURE__*/t(s)(this,"clearUserInfo",()=>{this._changeInternalUserId(void 0),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId()}}),/*@__PURE__*/t(s)(this,"getAnonymousId",()=>this._userInfo.anonymousId),/*@__PURE__*/t(s)(this,"setUIViewedAttributes",e=>{if(!e)throw Error("Missing uiViewedAttributes");if("object"!=typeof e||Array.isArray(e))throw Error("Invalid uiViewedAttributes type, should be a non array object");this._uiViewedAttributes=S({},e)}),/*@__PURE__*/t(s)(this,"getUIViewedAttributes",()=>this._uiViewedAttributes),/*@__PURE__*/t(s)(this,"clearUIViewedAttributes",()=>{this._uiViewedAttributes={}}),/*@__PURE__*/t(s)(this,"sendIdentifyEvent",(e,t,r)=>{this.setUserInfo(e,t);let i={userIdType:e,eventType:a.eventType.IDENTIFY};return this._processEvent(t,i,this._context,r)}),/*@__PURE__*/t(s)(this,"sendPageEvent",(e,t)=>this.sendScreenEvent(e,t)),/*@__PURE__*/t(s)(this,"sendScreenEvent",(e,t,r)=>{let i,s,n,o;"object"==typeof e?(/* This is for retrocompatibility */i=e.name,s=e.attributes,n=e.containers,o=e.tags):(i=e,s=r),(0,h.validateScreenEvent)(i),(0,h.validateContainers)(n);let a=(0,u.buildScreenEvent)(this._productInfo,this._tenantInfo,this._userInfo,s,e.nonPrivacySafeAttributes,o,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,e,n),c=S({name:i},a);return this._setLastScreenEvent(c),this._processEvent(i,c,this._context,(0,T.default)(t,c))}),/*@__PURE__*/t(s)(this,"sendTrackEvent",(e,t)=>{(0,h.validateTrackEvent)(e);let r=(0,u.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.TRACK,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo);return this._processEvent((0,u.buildActionName)(e),r,this._context,(0,T.default)(t,r))}),/*@__PURE__*/t(s)(this,"sendUIEvent",(e,t)=>{(0,h.validateUIEvent)(e);let r=(0,u.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.UI,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo);return this._processEvent((0,u.buildActionName)(e),r,this._context,(0,T.default)(t,r))}),/*@__PURE__*/t(s)(this,"sendOperationalEvent",(e,t)=>{(0,h.validateOperationalEvent)(e);let r=(0,u.buildActionEvent)(this._productInfo,this._tenantInfo,this._userInfo,e,a.eventType.OPERATIONAL,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this.task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo);return this._processEvent((0,u.buildActionName)(e),r,this._context,(0,T.default)(t,r))}),/*@__PURE__*/t(s)(this,"startUIViewedEvent",e=>{this.stopUIViewedEvent(),this._uiViewedEvent=new E.default(this._productInfo,()=>({embeddedProduct:this._productInfo.embeddedProduct(),subproduct:this._productInfo.subproduct(),tenantIdType:this._tenantInfo.tenantIdType,tenantId:this._tenantInfo.tenantId,userId:this._userInfo.userId,lastScreenEvent:this._getLastScreenEvent(),attributes:this._uiViewedAttributes}),t=>this.sendUIEvent(t,e)),this._uiViewedEvent.start()}),/*@__PURE__*/t(s)(this,"stopUIViewedEvent",()=>{this._uiViewedEvent&&(this._uiViewedEvent.stop(),this._uiViewedEvent=null)}),/*@__PURE__*/t(s)(this,"resetUIViewedTimers",()=>{this._uiViewedEvent&&this._uiViewedEvent.resetTimers()}),/*@__PURE__*/t(s)(this,"startApdexEvent",e=>{this._apdexEvent.start(e)}),/*@__PURE__*/t(s)(this,"getApdexStart",e=>this._apdexEvent.getStart(e)),/*@__PURE__*/t(s)(this,"stopApdexEvent",(e,t)=>{this._apdexEvent.stop(e,t)}),/*@__PURE__*/t(s)(this,"startLowPriorityEventDelay",(e,t)=>{this.eventDelayQueue.startLowPriorityEventDelay(e,t)}),/*@__PURE__*/t(s)(this,"stopLowPriorityEventDelay",()=>{this.eventDelayQueue.stopLowPriorityEventDelay()}),/*@__PURE__*/t(s)(this,"onEvent",(e,t)=>{if(!t)throw Error("Missing analyticsData");if(!t.eventType)throw Error("Missing analyticsData.eventType");if(t.eventType===a.eventType.TRACK)return this.sendTrackEvent(t);if(t.eventType===a.eventType.UI)return this.sendUIEvent(t);if(t.eventType===a.eventType.OPERATIONAL)return this.sendOperationalEvent(t);if(t.eventType===a.eventType.SCREEN)return this.sendScreenEvent(t.name,null,t.attributes);if(t.eventType===a.eventType.IDENTIFY)return this.sendIdentifyEvent(t.userIdType,t.userId);throw Error(`Invalid analyticsData.eventType '${t.eventType}', must be an eventType: [${(0,a.objectValues)(a.eventType)}]`)}),!e)throw Error("Missing productInfo");if(!e.env)throw Error("Missing productInfo.env");if(!e.product)throw Error("Missing productInfo.product");if(!(0,a.isType)(a.envType,e.env))throw Error(`Invalid productInfo.env '${e.env}', must be an envType: [${(0,a.objectValues)(a.envType)}]`);if(e.perimeter&&!(0,a.isType)(a.perimeterType,e.perimeter))throw Error(`Invalid productInfo.perimeter '${e.perimeter}', must be an perimeterType: [${(0,a.objectValues)(a.perimeterType)}]`);if(e.origin){if(!(0,a.isType)(a.originType,e.origin))throw Error(`Invalid productInfo.origin '${e.origin}', must be an originType: [${(0,a.objectValues)(a.originType)}]`)}else e.origin=a.originType.WEB;e.platform?(0,h.validatePlatform)(e):e.platform=e.origin===a.originType.WEB?a.platformType.WEB:a.platformType.DESKTOP,this.logger=r.logger||console,this._productInfo=S(S({},e),{},{subproduct:this._createSubproductGetter(e.subproduct),embeddedProduct:this._createEmbeddedProductGetter(e.embeddedProduct)}),this._tenantInfo={},this._orgInfo={},this._uiViewedAttributes={},this._context=(0,u.buildContext)(this._productInfo),this._safeSessionStorage=new g.default;let i=this._useStargate(r.useStargate),n=r.apiHost||this._selectHost({useStargate:i,env:e.env,useLegacyUrl:r.useLegacyUrl,perimeter:e.perimeter}),_=r.apiHostProtocol||"https",P=r.minRetryDelay||1e3,x={maxRetryDelay:6e4,minRetryDelay:P,backoffFactor:2,flushWaitMs:r.flushWaitInterval,flushBeforeUnload:r.flushBeforeUnload},D=`awc-${e.env}`;this.eventProcessor=new p.default({apiHost:n,apiHostProtocol:_,product:e.product,retryQueuePrefix:D,retryQueueOptions:x,xidPromiseGetter:()=>(0,w.XIDPromise)(r.xidConsent,r.xidPromiseFn),logger:this.logger}),this._userInfo={anonymousId:this.eventProcessor.getUser().getAnonymousId(null==r?void 0:r.customAnonymousIdGenerator)},this._pageVisibility=new m.default,this._tabTracking=new v.default,this._sessionTracking=new y.default({sessionExpiryTime:r.sessionExpiryTime,onNewSessionStarted:r.onNewSessionStarted}),this.task=new I.default,this.originTracing=new f.default,// Init Apdex
this._apdexEvent=new c.default(this.sendOperationalEvent,this._pageVisibility),this._historyReplaceFn="function"==typeof r.historyReplaceFn?r.historyReplaceFn:O.defaultHistoryReplaceFn,this.eventDelayQueue=new d.default(this._fireDelayedEvent,r.delayQueueCompressors||[]),this._testingCache=new b.default,this._pageLoadId=/*@__PURE__*/t(o)(),this._workspaceInfo={}}}}),o("dZz5i",function(e,t){var r=n("jyqcr"),i=n("fkQUF");e.exports=function(e,t,s){var n=t&&s||0;"string"==typeof e&&(t="binary"===e?Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();// Copy bytes to buffer, if provided
if(// Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[n+a]=o[a];return t||i(o)}}),o("jyqcr",function(e,t){// Unique ID creation requires a high quality random # generator.  In the
// browser this is a little complicated due to unknown quality of Math.random()
// and inconsistent support for the `crypto` API.  We do the best we can via
// feature-detection
// getRandomValues needs to be invoked in a context where "this" is a Crypto
// implementation. Also, find the complete implementation of crypto on IE11.
var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){// WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto
var i=new Uint8Array(16);// eslint-disable-line no-undef
e.exports=function(){return r(i),i}}else{// Math.random()-based (RNG)
//
// If all else fails, use Math.random().  It's fast, but is of unspecified
// quality.
var s=Array(16);e.exports=function(){for(var e,t=0;t<16;t++)(3&t)==0&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}}),o("fkQUF",function(e,t){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0;// join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4
return[r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]]].join("")}}),o("hKBww",function(t,r){var i,s,n,o,a,c,l,u,d;e(t.exports,"envType",()=>h),e(t.exports,"eventType",()=>p),e(t.exports,"platformType",()=>f),e(t.exports,"originType",()=>m),e(t.exports,"tenantType",()=>y),e(t.exports,"userType",()=>g),e(t.exports,"apdexType",()=>v),e(t.exports,"desktopPlatforms",()=>I),e(t.exports,"webPlatforms",()=>b),e(t.exports,"originTracingType",()=>E),e(t.exports,"objectValues",()=>O),e(t.exports,"isType",()=>T),e(t.exports,"perimeterType",()=>w);// These types have been converted from frozen objects to enums.
// We cannot change their name, or even capitalise them without breaking API.
let h=((i={}).LOCAL="local",i.DEV="dev",i.STAGING="staging",i.PROD="prod",i),p=((s={}).TRACK="track",s.UI="ui",s.OPERATIONAL="operational",s.SCREEN="screen",s.IDENTIFY="identify",s),f=((n={}).MAC="mac",n.LINUX="linux",n.WINDOWS="windows",n.DESKTOP="desktop",n.WEB="web",n.MOBILE_WEB="mobileWeb",n),m=((o={}).DESKTOP="desktop",o.WEB="web",o),y=((a={}).CLOUD_ID="cloudId",a.ORG_ID="orgId",a.OPSGENIE_CUSTOMER_ID="opsgenieCustomerId",a.HALP_TEAM_ID="halpTeamId",a.TRANSACTION_ACCOUNT_ID="transactionAccountId",a.TRELLO_WORKSPACE_ID="trelloWorkspaceId",a.NONE="none",a),g=((c={}).ATLASSIAN_ACCOUNT="atlassianAccount",c.HASHED_EMAIL="hashedEmail",c.TRELLO="trello",c.OPSGENIE="opsgenie",c.HALP="halp",c),v=((l={}).TRANSITION="transition",l.INITIAL_LOAD="initialLoad",l),I=Object.freeze([f.DESKTOP,f.MAC,f.LINUX,f.WINDOWS]),b=Object.freeze([f.WEB,f.MOBILE_WEB]),E=((u={}).ATL_ORIGIN="atlOrigin",u);function O(e){return Object.values(e)}function T(e,t){return Object.values(e).indexOf(t)>-1}let w=((d={}).C5="c5",d.COMMERCIAL="commercial",d.FEDRAMP_MODERATE="fedramp-moderate",d.FEDRAMP_HIGH="fedramp-high",d)}),o("4Q3vo",function(r,i){e(r.exports,"default",()=>d);var s=n("i5ijL"),o=n("hKBww"),a=n("aSWoh"),c=n("jB6ZF");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function u(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?l(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}class d{constructor(e,r){if(/*@__PURE__*/t(s)(this,"_getEventKey",({task:e,taskId:t})=>t?`${e}.${t}`:e),/*@__PURE__*/t(s)(this,"_getEventTimingByName",e=>{let t=this._performance.getEntriesByName(e),r=t[t.length-1];return r}),/*@__PURE__*/t(s)(this,"_getApdexFields",e=>{let t=this._getApdexTimings(e),r=this._calculateApdex({duration:t.duration,threshold:e.threshold});return u(u({},t),{},{apdex:r})}),/*@__PURE__*/t(s)(this,"_getApdexTimings",e=>{let t=this._getEventKey(e),r=`${t}-start`,i=e.startTime||this._getStartTime(e,r),s=e.stopTime||this._getStopTime();return(// We do some clean up of the marks and started events
this._cleanApdexState(t),{startTime:i,stopTime:s,duration:s-i})}),/*@__PURE__*/t(s)(this,"_getStartTime",(e,t)=>{let r;let i=this._performance.getTimeOrigin();if(e.type===o.apdexType.INITIAL_LOAD)r=i;else{let e=this._getEventTimingByName(t);r=i+e.startTime}return r}),/*@__PURE__*/t(s)(this,"_getStopTime",()=>this._performance.getTimeOrigin()+this._performance.now()),/*@__PURE__*/t(s)(this,"_cleanApdexState",e=>{this._performance.clearMarks(`${e}-start`),this._performance.clearMarks(`${e}-stop`),this._startedEvents.delete(e)}),/*@__PURE__*/t(s)(this,"_getVisibilityFields",e=>{let t;/**
       * For initialLoad type:
       * 1. if tab was not ever hidden (!_wasPreviouslyHidden)
       *
       * For transition type:
       * 1. active status is tracked in active events map (_isActiveEvents)
       *
       * For any type, if startTime or stopTime is specified:
       * 1. If currently active (!_isHidden)
       */if(e.type===o.apdexType.INITIAL_LOAD)t=!this._wasPreviouslyHidden;else if(e.type===o.apdexType.TRANSITION){let r=this._getEventKey(e);t=this._isActiveEvents.get(r)}return(e.startTime||e.stopTime)&&(t=!this._pageVisibility.getIsHidden()),{isActiveTab:t}}),/*@__PURE__*/t(s)(this,"_calculateApdex",({duration:e,threshold:t=this._threshold})=>e<=t?1:e<=4*t?.5:0),/*@__PURE__*/t(s)(this,"_validateStartEvent",e=>{if(!e)throw Error('Missing "event" in Apdex start event');if(!e.task)throw Error('Missing "task" in Apdex start event');if("string"!=typeof e.task)throw Error('Invalid "task" in Apdex start event');if(e.taskId&&"string"!=typeof e.taskId)throw Error('Invalid "taskId" in Apdex start event')}),/*@__PURE__*/t(s)(this,"_validateStopEvent",e=>{if(!e)throw Error('Missing "event" in Apdex stop event');if(!e.task)throw Error('Missing "task" in Apdex stop event');if("string"!=typeof e.task)throw Error('Invalid "task" in Apdex stop event');if(e.taskId&&"string"!=typeof e.taskId)throw Error('Invalid "taskId" in Apdex stop event');if(!e.type)throw Error('Missing "type" in Apdex stop event');if(e.type&&!(0,o.isType)(o.apdexType,e.type))throw Error('Invalid "type" in Apdex stop event');if(e.threshold&&"number"!=typeof e.threshold)throw Error('Invalid "threshold" in Apdex stop event');/*
       * For a transition, if the startTime was not specified,
       * the start event should have been present.
       */if(!e.startTime&&e.type===o.apdexType.TRANSITION){let t=this._getEventKey(e);if(!this._startedEvents.has(t))throw Error(`Apdex event transition "${t}" was not started`)}if(e.startTime&&!("number"==typeof e.startTime&&e.startTime>=0))throw Error('Invalid "startTime" in Apdex stop event');if(e.stopTime&&"number"!=typeof e.stopTime)throw Error('Invalid "stopTime" in Apdex stop event');if(e.stopTime<=e.startTime)throw Error('"stopTime" should be greater than "startTime" in Apdex stop event')}),/*@__PURE__*/t(s)(this,"_shouldSendEvent",e=>!!e&&"number"==typeof e.apdex),/*@__PURE__*/t(s)(this,"_sendEvent",(e,t)=>{this._shouldSendEvent(e)&&this._onEvent({source:"ui",action:"readyForUser",actionSubject:"ui",attributes:u(u({},e.additionalAttributes),{},{task:e.task,taskId:e.taskId,type:e.type,threshold:e.threshold||this._threshold,apdex:e.apdex,startTime:e.startTime,stopTime:e.stopTime,duration:e.duration,isActiveTab:e.isActiveTab})},t)}),!e)throw Error("Missing onEvent callback");if("function"!=typeof e)throw Error("Invalid onEvent, must be function");if(!(r instanceof a.default))throw Error("Invalid pageVisibility, must be PageVisibility class");this._startedEvents=new Map,this._performance=new c.default,this._onEvent=e,this._threshold=1e3,this._wasPreviouslyHidden=r.getIsHidden(),this._isActiveEvents=new Map,this._pageVisibility=r,this._pageVisibility.addCallback("apdexEvent",e=>{this.onVisibilityChange(!e)})}start(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;let t=this._getEventKey(e),r=`${t}-start`;this._startedEvents.set(t,!0),this._isActiveEvents.set(t,!this._pageVisibility.getIsHidden()),this._performance.clearMarks(r),this._performance.mark(r)}getStart(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;let t=this._getEventKey(e),r=`${t}-start`;return this._getEventTimingByName(r)}stop(e,t){if(this._validateStopEvent(e),!this._performance.isAvailable())return;let r=this._getApdexFields(e),i=this._getVisibilityFields(e);this._sendEvent(u(u(u({},e),r),i),t)}onVisibilityChange(e){e||(this._wasPreviouslyHidden=!0,this._isActiveEvents.forEach((e,t)=>this._isActiveEvents.set(t,!1)))}}}),o("aSWoh",function(r,i){e(r.exports,"default",()=>o);var s=n("i5ijL");class o{constructor(){/*@__PURE__*/t(s)(this,"_bindEventListeners",()=>{document.addEventListener(this._visibilityChange,this._handleVisibilityChange,!1)}),/*@__PURE__*/t(s)(this,"_handleVisibilityChange",()=>{let e=document[this._hidden];this._isHidden=e,this._callbacks.forEach(t=>t(e))}),this._isHidden=!1,this._callbacks=new Map,this._hidden=void 0,this._visibilityChange=void 0,void 0!==document.hidden?(// Opera 12.10 and Firefox 18 and later support
this._isHidden=document.hidden,this._hidden="hidden",this._visibilityChange="visibilitychange"):void 0!==document.msHidden?(this._isHidden=document.msHidden,this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this._isHidden=document.webkitHidden,this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),void 0!==document.addEventListener&&void 0!==this._hidden&&this._bindEventListeners()}addCallback(e,t){if("string"!=typeof e)throw Error("Invalid name, must be string");if("function"!=typeof t)throw Error("Invalid callback, must be function");this._callbacks.set(e,t)}removeCallback(e){this._callbacks.has(e)&&this._callbacks.delete(e)}getIsHidden(){return this._isHidden}}}),o("jB6ZF",function(t,r){e(t.exports,"default",()=>i);class i{constructor(){this._performance=window.performance}clearMarks(...e){this._performance&&this._performance.clearMarks&&this._performance.clearMarks(...e)}mark(...e){this._performance&&this._performance.mark&&this._performance.mark(...e)}getEntriesByName(...e){return this._performance&&this._performance.getEntriesByName?this._performance.getEntriesByName(...e):[]}getTimeOrigin(){return this._performance&&(this._performance.timeOrigin||this._performance.timing)?this._performance.timeOrigin||this._performance.timing.navigationStart:0}now(){return this._performance&&this._performance.now?this._performance.now():Date.now?Date.now():+new Date}isAvailable(){return!!this._performance&&!!this._performance.clearMarks&&!!this._performance.mark&&!!this._performance.getEntriesByName&&!!this._performance.timing}}}),o("3zP8R",function(t,r){e(t.exports,"default",()=>s);/**
 * Wraps {possibleFn} into a error-safe function and handles cases where {possibleFn}
 * is a function or object
 *
 * @param possibleFn - function that returns and object or the object itself
 * @param errorMessage - error message to log if {possibleFn} is a function and
 *                        throws an error when called
 * @returns {Function}
 */let i=e=>"function"==typeof e;var s=(e,t)=>()=>{if(i(e))try{return e()}catch(e){// eslint-disable-next-line no-console
    console.error(`${t} - ${e instanceof Error?e.message:String(e)}`);return}return e}}),o("b62iB",function(r,i){e(r.exports,"buildActionFields",()=>b),e(r.exports,"buildScreenEvent",()=>E),e(r.exports,"buildActionName",()=>O),e(r.exports,"buildContext",()=>T),e(r.exports,"buildActionEvent",()=>w);var s=n("i5ijL"),o=n("hKBww"),a=n("dqBnG");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function l(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?c(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function u(e){return{tenantIdType:e.tenantIdType,tenantId:e.tenantId}}function d(e){return{userIdType:e.userIdType}}function h(e){return{orgId:e.orgId}}function p(e){return{workspaceId:e.workspaceId}}function f(e){return e.anonymousId?{anonymousId:e.anonymousId}:{}}function m(e,t){return void 0===t?e:t}function y(e,t){let r=t||{},i=m(e.env,r.env),s=m(e.product,r.product),n=m(e.subproduct(),r.subproduct),o=m(e.version,r.version),a=m(e.origin,r.origin),c=m(e.platform,r.platform);return{env:i,product:s,subproduct:n,version:o,origin:a,platform:c}}function g(e){return(0,a.isPlainObject)(e)&&Object.keys(e).length>0}function v(e,t){return g(t)?{[e]:t}:void 0}function I(e){if(g(e)){let t=function(e){let t={};return Object.keys(e).forEach(r=>{let i=e[r];t[r]={id:i.id,type:i.type}}),t}(e);return v("containers",t)}}function b(e,t){return l({containerType:e.containerType,containerId:e.containerId,source:e.source,objectType:e.objectType,objectId:e.objectId,actionSubject:e.actionSubject,action:e.action,actionSubjectId:e.actionSubjectId,attributes:e.attributes,nonPrivacySafeAttributes:e.nonPrivacySafeAttributes,tags:e.tags,highPriority:e.highPriority,eventType:t},I(e.containers))}function E(e,t,r,i,s,n,a,c,m,g,b,E,O,T){let w=y(e),_=u(t),S=d(r),A=h(g),P=p(E),x={title:"",path:"",url:"",referrer:"",search:"",eventType:o.eventType.SCREEN};return l(l(l(l(l(l(l(l(l(l({},w),_),S),A),x),v("attributes",i)),v("nonPrivacySafeAttributes",s)),I(T)),f(O)),{},{tags:n,tabId:a,sessionId:c,taskSessions:m,pageLoadId:b},P)}function O(e){return`${e.actionSubject} ${e.action}`}function T(e){let t=window.screen||{};return{context:{locale:e.locale,screen:{width:t.width,height:t.height,density:window.devicePixelRatio},library:{name:"analytics.js",version:"4.18.0"}}}}function w(e,t,r,i,s,n,o,a,c,m,g){let v=y(e,function(e){let{env:t,product:r,subproduct:i,version:s,origin:n,platform:o}=e;return{env:t,product:r,subproduct:i,version:s,origin:n,platform:o}}(i)),I=u(t),E=h(c),O=p(g),T=d(r),w=b(i,s);return l(l(l(l(l(l(l({},v),I),E),T),w),f(i)),{},{tabId:n,sessionId:o,taskSessions:a,pageLoadId:m},O)}}),o("dqBnG",function(t,r){function i(e){return!0==(null!==e&&"object"==typeof e&&!1===Array.isArray(e))&&"[object Object]"===Object.prototype.toString.call(e)}function s(e){if(!1===i(e))return!1;// If has modified constructor
let t=e.constructor;if("function"!=typeof t)return!1;// If has modified prototype
let r=t.prototype;return!1!==i(r)&&"isPrototypeOf"in r}e(t.exports,"isPlainObject",()=>s)}),o("gJ6s6",function(r,i){e(r.exports,"default",()=>l);var s=n("i5ijL"),o=n("55aOU"),a=n("4hPyc"),c=n("fqWOn");class l{constructor(e,r){/*@__PURE__*/t(s)(this,"push",(e,t,r,i)=>{this.delayQueue.push(e,t,r,i)}),/*@__PURE__*/t(s)(this,"startLowPriorityEventDelay",(e=o.DEFAULT_DELAY_TIMEOUT,t)=>{if(Number.isNaN(e)||e<=0)throw Error(`Invalid timeout period: ${e}, must be a number greater than 0`);this.delayTimeout&&clearTimeout(this.delayTimeout);let r=e?Math.min(e,o.MAX_DELAY_TIMEOUT):o.MAX_DELAY_TIMEOUT;this.delayCallback=t,this.delayTimeout=setTimeout(()=>this.stopLowPriorityEventDelay(c.StopLowPriorityEventDelayReason.TIMEOUT),r),// If the queue is still flushing from a previous delay period, then we should cancel that flush
// to stop it from negatively impacting the performance of the new critical section
this.delayQueue.cancelFlush(),this.isDelaying=!0}),/*@__PURE__*/t(s)(this,"stopLowPriorityEventDelay",(e=c.StopLowPriorityEventDelayReason.MANUAL)=>{var t;this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.delayQueue.startFlush(),this.isDelaying=!1,null===(t=this.delayCallback)||void 0===t||t.call(this,e),this.delayCallback=void 0}),/*@__PURE__*/t(s)(this,"isDelayingLowPriorityEvents",()=>this.isDelaying),this.isDelaying=!1,this.delayQueue=new a.default(e,r)}}}),o("55aOU",function(t,r){e(t.exports,"DEFAULT_DELAY_TIMEOUT",()=>i),e(t.exports,"MAX_DELAY_TIMEOUT",()=>s);let i=1e4,s=3e4}),o("4hPyc",function(r,i){e(r.exports,"default",()=>l);var s=n("i5ijL"),o=n("b62iB"),a=n("gt0iD"),c=n("7RXaL");class l{constructor(e,r){/*@__PURE__*/t(s)(this,"push",(e,t,r,i)=>{this.eventArgs.push({identifier:e,builtEvent:t,context:r,userInfo:i})}),/*@__PURE__*/t(s)(this,"size",()=>this.eventArgs.length),/*@__PURE__*/t(s)(this,"startFlush",()=>{try{this.eventArgs=this.compressEventArgs(this.eventArgs)}catch(e){// eslint-disable-next-line no-console
console.warn(`Failed to perform compression on the delayed analytics events. Error: ${e.message}. Sending ${this.eventArgs.length} uncompressed events instead`)}this.flushNextBatch()}),/*@__PURE__*/t(s)(this,"cancelFlush",()=>{this.flushBatchTimeout&&(clearTimeout(this.flushBatchTimeout),this.flushBatchTimeout=null)}),/*@__PURE__*/t(s)(this,"flushNextBatch",()=>{let e=this.eventArgs.splice(0,7);e.forEach(e=>this.processFn(e.identifier,e.builtEvent,e.context,e.userInfo)),this.eventArgs.length>0?this.flushBatchTimeout=setTimeout(()=>this.flushNextBatch(),100):this.flushBatchTimeout=null}),/*@__PURE__*/t(s)(this,"compressEventArgs",e=>{let[t,r]=(0,a.partition)(e,e=>this.compressor.canCompress(e.builtEvent)),i=t.reduce((e,t)=>{let r=e.find(e=>(0,a.equals)(e.userInfo,t.userInfo)&&(0,a.equals)(e.context,t.context));return r?r.eventArgs.push(t):e.push({userInfo:t.userInfo,context:t.context,eventArgs:[t]}),e},[]),s=i.reduce((e,t)=>{try{let r=t.eventArgs.map(e=>e.builtEvent),i=this.compressor.compress(r),s=i.map(e=>({identifier:(0,o.buildActionName)(e),builtEvent:e,userInfo:t.userInfo,context:t.context}));return e.concat(s)}catch(e){return(// If anything goes wrong while compressing this group, then just fall back on the
// uncompressed events instead. The event compressor already handles errors with invalid
// generator functions or results, but this is an extra layer of defense to prevent data
// loss in the event of an unexpected error.
// eslint-disable-next-line no-console
console.warn(`Failed to compress some analytics events. Error: ${e.message}. Sending ${t.eventArgs.length} uncompressed events instead`),t.eventArgs)}},[]);return r.forEach(e=>s.push(e)),s}),this.processFn=e,this.flushBatchTimeout=null,this.eventArgs=[],this.compressor=new c.default(r)}}}),o("gt0iD",function(t,r){e(t.exports,"mapKeys",()=>i),e(t.exports,"pick",()=>s),e(t.exports,"omitBy",()=>n),e(t.exports,"pickBy",()=>o),e(t.exports,"omit",()=>a),e(t.exports,"equals",()=>c),e(t.exports,"partition",()=>l);/* eslint-disable no-return-assign, no-sequences */// https://www.30secondsofcode.org/js/s/map-keys
let i=(e,t)=>Object.keys(e).reduce((r,i)=>{let s=t(e[i],i,e);return r[s]=e[i],r},{}),s=(e,t)=>t.reduce((t,r)=>(r in e&&(t[r]=e[r]),t),{}),n=(e,t)=>Object.keys(e).filter(r=>!t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),o=(e,t)=>Object.keys(e).filter(r=>t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),a=(e,t)=>Object.keys(e).filter(e=>0>t.indexOf(e)).reduce((t,r)=>(t[r]=e[r],t),{}),c=(e,t)=>{if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e===t;if(e.prototype!==t.prototype)return!1;let r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>c(e[r],t[r]))},l=(e,t)=>e.reduce((e,r,i,s)=>(e[t(r,i,s)?0:1].push(r),e),[[],[]])}),o("7RXaL",function(r,i){e(r.exports,"default",()=>d);var s=n("i5ijL"),o=n("b62iB"),a=n("gt0iD"),c=n("ajN4c");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function u(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?l(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}class d{constructor(e=[]){if(/*@__PURE__*/t(s)(this,"canCompress",e=>this.compressionRules.some(t=>t.canCompress(e))),/*@__PURE__*/t(s)(this,"compress",e=>{let t=this.createGroups(e);return t.reduce((e,t)=>{let r=this.compressGroup(t);return e.concat(r)},[])}),/*@__PURE__*/t(s)(this,"createGroups",e=>// rather than passed in by the caller (eg. product, org. and tenant info)
    e.reduce((e,t)=>{let r;let i=this.compressionRules.find(e=>e.canCompress(t));if(i){let e=(0,o.buildActionFields)(t,t.eventType);r=(0,a.omit)(t,Object.keys(e))}let s=e.find(e=>i===e.compressor&&(0,a.equals)(r,e.contextFields));return s?s.events.push(t):e.push({contextFields:r,compressor:i,events:[t]}),e},[])),/*@__PURE__*/t(s)(this,"compressGroup",e=>{// If this group doesn't have any compressor, then the event args are already in their final format
if(!e.compressor)return e.events;try{// Run the compressor on the group to generate some new events.
// The compression function is only expected to return the action fields for each
// event that it generates, since all other fields are generated by the client.
let t=e.compressor.compress(e.events);// Add the context fields to each of the resulting events to inflate them into a full action event
return t.map(t=>u(u({},t),e.contextFields))}catch(t){return(// If we fail to compress the events, then just fall back the uncompressed events
// so that no data is lost. This can happen if the compression function throws an error
// or returns some invalid event payloads.
// eslint-disable-next-line no-console
console.warn(`Failed to compress some analytics events. Error: ${t.message}. Sending ${e.events.length} uncompressed events instead`),e.events)}}),!Array.isArray(e))throw Error("Event compressors must be constructed with an array of CompressionRules");if(!e.every(e=>e instanceof c.CompressionRule))throw Error("Event compressors can only be constructed with instances of CompressionRule");this.compressionRules=e}}}),o("ajN4c",function(r,i){e(r.exports,"CompressionRule",()=>c);var s=n("i5ijL"),o=n("3ZQ32"),a=n("gt0iD");class c{/**
   * @callback EventPredicate
   * @param {object} event An analytics event
   * @returns {boolean} A flag indicating whether or not the event matches the conditions
   *//**
   * @callback CompressionFunction
   * @param {Array.<Object>} events A collection of analytics events that match the predicate of this compression rule
   * @returns {Array.<Object>} compressedEvents The compressed analytics events to fire
   *//**
   * This constructor defines a new rule for compressing analytics events.
   * @param {EventPredicate} predicate
   * @param {CompressionFunction} compressFn
   */constructor(e,r){if(/*@__PURE__*/t(s)(this,"canCompress",e=>{try{return e&&(0,o.isActionEventType)(e.eventType)&&this.predicate(e)}catch(e){return!1}}),/*@__PURE__*/t(s)(this,"compress",e=>{let[t,r]=(0,a.partition)(e,e=>this.canCompress(e)),i=this.compressFn(t);if(!i)throw Error("No events were returned from the compression function");return i.forEach(e=>{(0,o.validateActionEventType)(e.eventType),(0,o.validateActionEvent)(e)}),i.concat(r)}),"function"!=typeof e)throw Error("Invalid predicate, must be a function that accepts an event and returns a boolean");if("function"!=typeof r)throw Error("Invalid compressFn, must be a function that both accepts and returns an array of events");this.predicate=e,this.compressFn=r}}}),o("3ZQ32",function(t,r){e(t.exports,"validateContainers",()=>a),e(t.exports,"isActionEventType",()=>c),e(t.exports,"validateActionEventType",()=>l),e(t.exports,"validateActionEvent",()=>u),e(t.exports,"validateScreenEvent",()=>d),e(t.exports,"validateTrackEvent",()=>h),e(t.exports,"validateUIEvent",()=>p),e(t.exports,"validateOperationalEvent",()=>f),e(t.exports,"validateIdentifyEvent",()=>m),e(t.exports,"validatePlatform",()=>y);var i=n("hKBww"),s=n("dqBnG");let o=Object.freeze([i.eventType.OPERATIONAL,i.eventType.TRACK,i.eventType.UI]);function a(e){if(e){if(e&&e.constructor!==Object)throw Error("properties.containers must be an Object");Object.values(e).forEach(e=>(function(e){if(!(0,s.isPlainObject)(e))throw Error("properties.containers must be an Object");if(!("id"in e))throw Error("properties.containers is missing field 'id'");if("string"!=typeof e.id)throw Error("properties.containers.id must be of type String");if("type"in e&&"string"!=typeof e.type)throw Error("properties.containers.type must be of type String")})(e))}}function c(e){switch(e){case i.eventType.OPERATIONAL:case i.eventType.TRACK:case i.eventType.UI:return!0;default:return!1}}function l(e){if(!c(e))throw Error(`Invalid action event type: ${e}, must be one of: [${o}]`);return!0}function u(e){if(!e)throw Error("Missing event");if(!e.source)throw Error("Missing event.source");if(!e.actionSubject)throw Error("Missing event.actionSubject");if(!e.action)throw Error("Missing event.action");a(e.containers)}function d(e){if(!e)throw Error("Missing name")}function h(e){u(e)}function p(e){u(e)}function f(e){u(e)}function m(e,t){if(!e)throw Error("Missing userIdType");if(!t)throw Error("Missing userId");if(!(0,i.isType)(i.userType,e))throw Error(`Invalid userIdType '${e}', must be an userType: [${(0,i.objectValues)(i.userType)}]`)}function y(e){if(!(0,i.isType)(i.platformType,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be a platformType: [${(0,i.objectValues)(i.platformType)}]`);if(e.origin===i.originType.DESKTOP&&!(0,i.isType)(i.desktopPlatforms,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be one of [mac, linux, windows]`);if(e.origin===i.originType.WEB&&!(0,i.isType)(i.webPlatforms,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be one of [web, mobileWeb]`)}}),o("fqWOn",function(t,r){var i;e(t.exports,"StopLowPriorityEventDelayReason",()=>s);let s=((i={}).TIMEOUT="timeout",i.MANUAL="manual",i)}),o("c3xvq",function(r,i){e(r.exports,"default",()=>g);var s=n("i5ijL"),o=n("dZz5i"),a=n("T79Sm"),c=n("h5nyR"),l=n("7nZf6"),u=n("cD5hU"),d=n("4oyDX"),h=n("6VXco"),p=n("f8NTQ"),f=n("7qddY");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function y(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?m(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}class g{constructor(e){/*@__PURE__*/t(s)(this,"sendEvents",async(e,t)=>{let r=this.resilienceQueue.getGlobalRetryCount(),i=this.metrics.getMetricsPayload(),s=y(y({},i),{},{httpRetryCount:r});for(let e in s)0===s[e]&&delete s[e];let n=await this.attachXIDs(e),o=new Date().toISOString(),a=n.map(e=>(e.msg.sentAt=o,e.msg));try{let e=await (0,d.sendEvents)({url:this.gasv3BatchUrl,batch:{batch:a,sentAt:o,metadata:s},timeout:this.options.requestTimeout});this.metrics.subtractFromMetrics(i),t(null,e)}catch(e){t(e,null)}}),this.user=new p.default,this.options=y(y({},e),{},{requestTimeout:e.requestTimeout||u.DEFAULT_REQUEST_TIMEOUT,retryQueueOptions:e.retryQueueOptions||{},logger:e.logger||console}),this.xidPromiseCallback=e.xidPromiseGetter(),this.gasv3BatchUrl=`${e.apiHostProtocol}://${e.apiHost}/batch`,this.metrics=(0,c.default)(),this.resilienceQueue=(0,a.default)(e.retryQueuePrefix,e.product,this.options.retryQueueOptions,this.options.logger),this.resilienceQueue.start(this.sendEvents)}getUser(){return this.user}async track(e,t,r,i){let s=this.buildBaseEvent(r,h.SegmentEventTypes.TRACK,t),n=y(y({},s),{},{type:h.SegmentEventTypes.TRACK,properties:(0,f.prepareEventProperties)(t),event:e}),o=y(y({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.resilienceQueue.addItem(a),i&&i()}async page(e,t,r,i){let s=this.buildBaseEvent(r,h.SegmentEventTypes.PAGE,t),n=y(y({},s),{},{type:h.SegmentEventTypes.PAGE,properties:(0,f.prepareEventProperties)(t),name:e}),o=y(y({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.resilienceQueue.addItem(a),i&&i()}// Segment uses the identifier to update user id which we have already done in the analyticsWebClient.ts
async identify(e,t,r,i){let s=this.buildBaseEvent(r,h.SegmentEventTypes.IDENTIFY,t),n=y(y({},s),{},{type:h.SegmentEventTypes.IDENTIFY,traits:(0,f.prepareEventProperties)(t)}),o=y(y({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.resilienceQueue.addItem(a),i&&i()}buildBaseEvent(e,t,r){let i=(0,f.prepareEventProperties)(e),s=(0,f.buildContext)(i);return{context:s,timestamp:new Date().toISOString(),type:t,userId:this.user.getUserId(),anonymousId:r.anonymousId||this.user.getAnonymousId()}}createMessageId(){return`ajs-${/*@__PURE__*/t(o)()}`}packageEvent(e){let{apiHost:t,apiHostProtocol:r}=this.options;return{headers:{"Content-Type":"text/plain"},msg:e,url:`${r}://${t}/${e.type.charAt(0)}`}}async attachXIDs(e){return this.xidPromiseCallback?(0,l.attachXidToMultipleEvents)(e,this.xidPromiseCallback):Promise.resolve(e)}}}),o("T79Sm",function(t,r){e(t.exports,"default",()=>s);var i=n("fmF48"),s=(e,t,r,s)=>new i.default(e,t,r||{},s)}),o("fmF48",function(r,i){e(r.exports,"default",()=>b);var s=n("i5ijL"),o=n("9v7s7"),a=n("6lfK1"),c=n("aPfNQ"),l=n("1dggx"),u=n("dlqat"),d=n("h5nyR"),h=n("iSw2l"),p=n("dqWO8"),f=n("6Eahj"),m=n("jULys");function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function g(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?y(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let v={backoffFactor:0,backoffJitterPercentage:0,flushWaitMs:6e4,minRetryDelay:6e4,maxRetryDelay:6e4},I={backoffFactor:2,backoffJitterPercentage:.2,batchFlushSize:7,flushBeforeUnload:!1,flushWaitMs:500,maxAttempts:10,// TODO figure out this number. For indexeddb we are sharing the queue with all tabs
maxItems:1e3,maxRetryDelay:3e4,minRetryDelay:1e3};class b{constructor(e,t,r,i){this.queuePrefix=e,// Avoiding using options in ResilienceDB at this stage as
// the options are optimised for the PushBatchableQueue
this.resilience=new l.default(t,{logger:i,maxAttempts:null==r?void 0:r.maxAttempts,maxEventLimit:null==r?void 0:r.maxItems}),this.options=this.buildOptions(r),this.scheduler=new p.default(g(g({},this.options),{},{waitInterval:null!=r&&r.flushBeforeUnload?0:this.options.flushWaitMs}),this.scheduleCallback.bind(this)),this.longPollingScheduler=new p.default(g(g({},v),{},{waitInterval:v.flushWaitMs}),this.scheduleLongCallBack.bind(this)),this.metricsCollector=(0,d.default)(),this.networkStatus=new h.default(e=>{e===m.NetworkStatusEnum.OFFLINE?this.scheduler.stop():this.checkEventCountAndReschedule()})}start(e){this.batchFlushCallback=e,this.longPollingScheduler.schedule()}stop(){this.scheduler.stop(),this.longPollingScheduler.stop()}async addItem(e){// Since Jira and Confluence use `.toJSON` on objects that should be strings
// And expect us to use `JSON.stringify` on these objects,
// And indexeddb strips these functions from the objects when adding them to the DB,
// We must run this silly stringify and parse before passing the event to the resilience meechanism.
// Planning on removing this in v4
let t=JSON.parse(JSON.stringify(e)),{numberOfEvictedItems:r}=await this.resilience.addItem(t,{},u.GuardPolicy.EVICT);this.scheduler.schedule(),this.metricsCollector.addToEventCount(),r>0&&this.metricsCollector.addToItemsDiscardedByOverflowCounter(r)}getGlobalRetryCount(){return this.scheduler.getFailureCount()}async scheduleCallback(e){// Even though we stopped the scheduler, it can be restarted with a call to schedule.
// This could be triggered by a new event or the longPollingScheduler
if(this.networkStatus.getNetworkStatus()===m.NetworkStatusEnum.OFFLINE){e(f.DoneState.NOOP);return}try{let t=await this.resilience.processItems(this.flush.bind(this),this.options.batchFlushSize);e(t)}catch(t){if(t.name===c.CallbackProcessingErrorName){e(f.DoneState.ERROR);return}// TODO we can probably log here but throwing is useless as it will just be shallowed by the Scheduler
// In theory something else should catch all other errors from indexeddb and this should never happen.
}finally{await this.checkEventCountAndReschedule()}}async checkEventCountAndReschedule(){let e=await this.resilience.getItemCount();e>0&&this.scheduler.schedule({immediate:e>=this.options.batchFlushSize})}async scheduleLongCallBack(e){// Eventually we will want to send data about how many queues were purged
let t=(0,o.default)(this.queuePrefix);this.metricsCollector.addToPurgedQueuesMetrics(t);// Eventually we will want to send data about how attempted reclaims and actual reclaims were made
let r=await (0,a.default)(this.queuePrefix,async e=>{let t=e.map(e=>({item:e.item,retryAttempts:e.attemptNumber,id:e.id})),{items:r}=await this.resilience.bulkAddItem(t,u.GuardPolicy.IGNORE);return r.length===t.length?{status:"successful"}:{status:"partial",acceptedItemIds:r.map(e=>e.id)}});this.metricsCollector.addToReclaimMetrics(r),// We dont want to flush events from here as there maybe issues with analytics-service
// Scheduler has all the context and can schedule the next batch accordingly
await this.checkEventCountAndReschedule(),e(f.DoneState.SUCCESS),this.longPollingScheduler.schedule()}flush(e,t){this.metricsCollector.setResilienceMechanism(this.resilience.storeType());let{batchFlushCallback:r}=this;if(!r)throw Error("batchFlushCallback has not been set. Call PullBatchableQueue#start first.");return new Promise((i,s)=>{if(e.length<=0){i(f.DoneState.NOOP);return}let n=e.map(e=>{let t=e.item;return e.retryAttempts>0&&t.msg&&(t.msg._metadata||(t.msg._metadata={}),t.msg._metadata.failedAttempts=e.retryAttempts),t});r(n,e=>{e?(t.numberOfDeletedItems>0&&this.metricsCollector.addToItemsDiscardedByRetryCounter(t.numberOfDeletedItems),s(e)):i(f.DoneState.SUCCESS)})})}buildOptions(e){return{backoffFactor:(null==e?void 0:e.backoffFactor)||I.backoffFactor,backoffJitterPercentage:(null==e?void 0:e.backoffJitterPercentage)!==void 0?e.backoffJitterPercentage:I.backoffJitterPercentage,batchFlushSize:(null==e?void 0:e.batchFlushSize)||I.batchFlushSize,flushBeforeUnload:(null==e?void 0:e.flushBeforeUnload)||I.flushBeforeUnload,flushWaitMs:(null==e?void 0:e.flushWaitMs)||I.flushWaitMs,maxItems:(null==e?void 0:e.maxItems)||I.maxItems,maxAttempts:(null==e?void 0:e.maxAttempts)||I.maxAttempts,maxRetryDelay:(null==e?void 0:e.maxRetryDelay)||I.maxRetryDelay,minRetryDelay:(null==e?void 0:e.minRetryDelay)||I.minRetryDelay}}}}),o("9v7s7",function(t,r){e(t.exports,"default",()=>a);var i=n("5MKMY"),s=n("fKyBd");// For more details on this funciton, see https://hello.atlassian.net/wiki/spaces/MEASURE/pages/585086028/Investigation+Local+storage+full
// TL;DR
// If a queue looses its `ack` key in localstorage, it will never get claimed.
// There is a small chance that this can happen.
// This function is to run through queues and clean any that have been orphaned.
// Keys stolen from https://github.com/segmentio/localstorage-retry/blob/master/lib/index.js#L55
let o=Object.values(i.LocalStorageKeySuffix);var a=e=>{if("string"!=typeof e||0===e.length)return 0;try{let t=Object.keys(localStorage).filter(t=>t&&t.startsWith(`${e}.`)||!1).map(e=>e.split(".")).filter(e=>3===e.length&&o.includes(e[2])).reduce((e,t)=>{let[,r,i]=t;return void 0===e[r]&&(e[r]={}),e[r][i]=!0,e},{}),r=Object.keys(t).filter(e=>!0!==t[e][i.LocalStorageKeySuffix.ACK]);return r.forEach(t=>{let{queue:r,inProgress:i,reclaimStart:n,reclaimEnd:o}=(0,s.createLocalStorageKeys)(e,t);localStorage.removeItem(i),localStorage.removeItem(r),localStorage.removeItem(n),localStorage.removeItem(o)}),r.length}catch(e){// Ignore errors from localStorage.
}return 0}}),o("5MKMY",function(t,r){var i,s;e(t.exports,"LocalStorageKeySuffix",()=>n),e(t.exports,"Timers",()=>o);let n=((i={}).IN_PROGRESS="inProgress",i.QUEUE="queue",i.RECLAIM_START="reclaimStart",i.RECLAIM_END="reclaimEnd",i.ACK="ack",i),o=((s={})[s.RECLAIM_TIMEOUT=1e4]="RECLAIM_TIMEOUT",s[s.RECLAIM_WAIT=500]="RECLAIM_WAIT",s[s.RECLAIM_WAIT_THRESHOLD=2e3]="RECLAIM_WAIT_THRESHOLD",s)}),o("fKyBd",function(t,r){e(t.exports,"createLocalStorageKeys",()=>s);var i=n("5MKMY");let s=(e,t)=>({[i.LocalStorageKeySuffix.ACK]:`${e}.${t}.${i.LocalStorageKeySuffix.ACK}`,[i.LocalStorageKeySuffix.QUEUE]:`${e}.${t}.${i.LocalStorageKeySuffix.QUEUE}`,[i.LocalStorageKeySuffix.IN_PROGRESS]:`${e}.${t}.${i.LocalStorageKeySuffix.IN_PROGRESS}`,[i.LocalStorageKeySuffix.RECLAIM_START]:`${e}.${t}.${i.LocalStorageKeySuffix.RECLAIM_START}`,[i.LocalStorageKeySuffix.RECLAIM_END]:`${e}.${t}.${i.LocalStorageKeySuffix.RECLAIM_END}`})}),o("6lfK1",function(r,i){e(r.exports,"default",()=>y);var s=n("i5ijL"),o=n("dZz5i"),a=n("5MKMY"),c=n("fKyBd");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function u(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?l(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}// Code we need to mimic:
// https://github.com/segmentio/localstorage-retry/blob/master/lib/index.js#L262-L357
// Note we do not want to run this library due to the performance, duplication and memory leak issues.
let d=e=>new Promise(t=>{setTimeout(t,e)}),h=e=>{try{return Object.keys(localStorage).filter(t=>t.startsWith(e)).map(e=>e.split(".")).filter(t=>{if(3===t.length&&t[0]===e&&t[2]===a.LocalStorageKeySuffix.ACK)try{let e=localStorage.getItem(t.join("."));if(e){let t=parseInt(e);return a.Timers.RECLAIM_TIMEOUT+t<Date.now()}}catch(e){// ignore and drop value
}return!1}).map(e=>e[1])}catch(e){// Ignore errors from accessing localStorage.
}return[]},p=async(e,t)=>{let{ack:r,reclaimStart:i,reclaimEnd:s}=e.storageKeys,n=Date.now();if(localStorage.setItem(i,e.reclaimProcessId),localStorage.setItem(r,n.toString()),await d(a.Timers.RECLAIM_WAIT),Date.now()>n+a.Timers.RECLAIM_WAIT_THRESHOLD||// Either the parent has caught up and removed our claim, or someone else started a claim instead
localStorage.getItem(i)!==e.reclaimProcessId)throw Error("Took to long to callback, reclaim abandonded. After reclaimStart.");if(localStorage.setItem(s,e.reclaimProcessId),await d(a.Timers.RECLAIM_WAIT),Date.now()>n+a.Timers.RECLAIM_WAIT_THRESHOLD||// Either the parent has caught up and removed our claim, or someone else started a claim instead
localStorage.getItem(i)!==e.reclaimProcessId||localStorage.getItem(s)!==e.reclaimProcessId)throw Error("Took to long to callback, reclaim abandonded. After reclaimEnd.");return f(e,t)},f=async(e,t)=>{let{queue:r,inProgress:i}=e.storageKeys,s=JSON.parse(localStorage.getItem(r)||"[]"),n=JSON.parse(localStorage.getItem(i)||"{}"),o=Object.entries(n).map(([e,t])=>{let r=u(u({},t),{},{// LocalStorage-retry would add the attemptCounter after failure, rather than
// as it was being processed
attemptNumber:t.attemptNumber+1,id:e});return r}),a=[...s,...o];if(a.length>0){let s=await t(a);if("successful"===s.status)m(e.storageKeys);else if("partial"===s.status){// Dont delete all events if we are only able to take some of them.
let e=a.filter(e=>!s.acceptedItemIds.includes(e.id));return(// This way around, we can almost ensure that we wont hit memory quota exceeded errors.
// However, there is a very small chance that we may lose events if the process exits between these two commands.
localStorage.removeItem(i),localStorage.setItem(r,JSON.stringify(e)),{fullReclaim:!1})}}else m(e.storageKeys);return{fullReclaim:!0}},m=e=>{// Always good to do queue and inprogress first to reduce duplications
// and to free up more space in localstorage
localStorage.removeItem(e.queue),localStorage.removeItem(e.inProgress),localStorage.removeItem(e.reclaimEnd),localStorage.removeItem(e.reclaimStart),// This has to be last or we risk leaving things in localStorage that have to be purged
localStorage.removeItem(e.ack)};var y=async(e,r)=>{if("string"!=typeof e||0===e.length)return{fullReclaims:0,partialReclaims:0,failedReclaims:0};let i=/*@__PURE__*/t(o)(),s=h(e),n=s.map(t=>p({queuePrefix:e,reclaimProcessId:i,storageKeys:(0,c.createLocalStorageKeys)(e,t)},r)),a=await Promise.allSettled(n),l=a.filter(e=>"rejected"===e.status),u=a.filter(e=>"fulfilled"===e.status).map(e=>e.value),d=u.filter(e=>e.fullReclaim),f=u.filter(e=>!e.fullReclaim);return{failedReclaims:l.length,partialReclaims:f.length,fullReclaims:d.length}}}),o("aPfNQ",function(t,r){e(t.exports,"CallbackProcessingErrorName",()=>i),e(t.exports,"default",()=>s);let i="CallbackProcessingError";class s extends Error{constructor(e){let t=e&&"object"==typeof e&&"toString"in e&&"function"==typeof e.toString&&e.toString(),r=t||"string"==typeof e&&e||"Argument passed to CallbackProcessingError was not an Error or string.";super(`Error thrown while processing events in callback: ${r}`),// Must reset the prototypes after calling super of builtin classes
// https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work
Object.setPrototypeOf(this,s.prototype),this.name=i}}}),o("1dggx",function(t,r){e(t.exports,"default",()=>s);var i=n("auup1");n("dlqat"),n("aPfNQ");var s=i.default}),o("auup1",function(t,r){e(t.exports,"default",()=>u);var i=n("dlqat"),s=n("3FBsr"),o=n("7pn5U"),a=n("6wV8e"),c=n("d2Lvd"),l=n("2xqEu");class u{constructor(e,t={}){if(this.namespace=e,this.options=(0,l.createOptionsWithDefaults)(t),!e||0===e.length||"string"!=typeof e)throw Error("Invalid namespace provided");this.resilience=this.getResilienceMechanism(e,t)}getResilienceMechanism(e,t){if(!t.useMemory)try{return new a.default(e,t)}catch(e){if(!(e instanceof s.default)){var r;null===(r=t.logger)||void 0===r||r.warn("Attempted to create IndexedDbResilience but failed. Using memory instead.")}}return new c.default(this.namespace,t)}addItem(e,t,r=i.GuardPolicy.ABANDON){return this.runOrFailOver(()=>this.resilience.addItem(e,t,r))}bulkAddItem(e,t=i.GuardPolicy.ABANDON){return this.runOrFailOver(()=>this.resilience.bulkAddItem(e,t))}getItems(e){return this.runOrFailOver(()=>this.resilience.getItems(e))}deleteItems(e){return this.runOrFailOver(()=>this.resilience.deleteItems(e))}getItemCount(){return this.runOrFailOver(()=>this.resilience.getItemCount())}processItems(e,t){return this.runOrFailOver(()=>this.resilience.processItems(e,t))}storeType(){return this.resilience.storeType()}async runOrFailOver(e){try{return await e()}catch(t){if((0,o.shouldIgnoreResilienceDbError)(t))throw t;return this.resilience.storeType()===i.StoreType.INDEXEDDB&&await this.failOver(),e()}}async failOver(){// Attempt to get any events we can and put them into memory
let e=this.resilience,t=new c.default(this.namespace,this.options);this.resilience=t;try{let{items:r}=await e.getItems(this.options.maxEventLimit);if(r.length>0){let s=await t.bulkAddItemWrapperType(r,i.GuardPolicy.IGNORE),n=s.items.map(e=>e.id);await e.deleteItems(n)}}catch(e){this.options.logger.warn("Unexpected error from ResilienceDb, switching to MemoryDb");// Dont need to catch. We are just getting events if we can
}}}}),o("dlqat",function(t,r){var i,s;e(t.exports,"NAMESPACE_AND_TIME_ADDED_INDEX",()=>n),e(t.exports,"RESILIENCE_DB_NAME",()=>o),e(t.exports,"RESILIENCE_STORE_NAME",()=>a),e(t.exports,"TIME_TO_PROCESS_AFTER_INDEX",()=>c),e(t.exports,"TIME_ADDED_INDEX",()=>l),e(t.exports,"RETRY_INDEX",()=>u),e(t.exports,"INDEXEDDB_TIMEOUT",()=>d),e(t.exports,"StoreType",()=>h),e(t.exports,"GuardPolicy",()=>p);let n="namespace-timeAdded",o="analytics-web-client",a="analytics-resilience",c="timeToBeProcessedAfter",l="timeAdded",u="retryAttempts",d=15e3,h=((i={}).INDEXEDDB="indexeddb",i.MEMORY="memory",i),p=((s={}).IGNORE="ignore",s.ABANDON="abandon",s.EVICT="evict",s)}),o("3FBsr",function(t,r){e(t.exports,"default",()=>i);class i extends Error{constructor(){super("window.indexeddb is undefined."),// Must reset the prototypes after calling super of builtin classes
// https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work
Object.setPrototypeOf(this,i.prototype),this.name="NoIndexedDbError"}}}),o("7pn5U",function(t,r){e(t.exports,"shouldIgnoreResilienceDbError",()=>a);var i=n("9MDAj"),s=n("aPfNQ"),o=n("bMhih");let a=e=>!!e&&"object"==typeof e&&"name"in e&&"string"==typeof e.name&&(e.name===i.AbandonWriteErrorName||e.name===s.CallbackProcessingErrorName||e.name===o.InvalidPolicyErrorName)}),o("9MDAj",function(t,r){e(t.exports,"AbandonWriteErrorName",()=>i),e(t.exports,"default",()=>s);let i="AbandonWriteError";class s extends Error{constructor(e){super(`Event Limit reached. Abandoning write to: ${e}`),// Must reset the prototypes after calling super of builtin classes
// https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work
Object.setPrototypeOf(this,s.prototype),this.name=i}}}),o("bMhih",function(t,r){e(t.exports,"InvalidPolicyErrorName",()=>i),e(t.exports,"default",()=>s);let i="InvalidPolicyError";class s extends Error{constructor(e,t){super(`Method '${t}' cannot be called with policy '${e}'.`),this.name=i}}}),o("6wV8e",function(r,i){e(r.exports,"default",()=>v);var s=n("ky31y"),o=n("i5ijL"),a=n("dlqat"),c=n("a3tO3"),l=n("aPfNQ"),u=n("bMhih"),d=n("3FBsr"),h=n("7pn5U"),p=n("4HWNf"),f=n("2xqEu");let m=["item"],y=["items"];function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}class v{constructor(e,r={}){if(/*@__PURE__*/t(o)(this,"startDB",async()=>new Promise(async(e,t)=>{window.setTimeout(()=>{this.logger.warn("IndexedDB timed out."),t(new d.default)},a.INDEXEDDB_TIMEOUT);/*
         * The database version number can never change.
         * An upgrade transaction is limited to only one connection to the database.
         * Once this is done, we cannot open any connections with older versions of the schema.
         * https://www.w3.org/TR/IndexedDB/#upgrade-transaction-construct
         *
         * Due to the nature of how AWC is used (multiple tabs that are very long lived),
         * we will not be able to run version upgrades via indexeddb.
         *
         * This does not mean we cant change what is stored in the tables,
         * this limitation just prevents us from:
         *   - Creating new ObjectStores in this database connection, and
         *   - Creating new indexes on our ObjectStores
         *
         * Any upgrades we wish to run in the future will have to create a new database,
         * and migrate all the data from older databases.
         *
         * This also means any migrations we make will have to be supported until we have evidence
         * that no events are coming from old versions of the database.
         * This may take a long time.
         */let r=window.indexedDB.open(a.RESILIENCE_DB_NAME,1);r.onupgradeneeded=e=>{if(0!==e.oldVersion)throw Error("We cannot upgrade the database. Do not do this.");let t=r.result,i=t.createObjectStore(a.RESILIENCE_STORE_NAME,{keyPath:"id"});i.createIndex(a.TIME_TO_PROCESS_AFTER_INDEX,a.TIME_TO_PROCESS_AFTER_INDEX,{unique:!1}),i.createIndex(a.RETRY_INDEX,a.RETRY_INDEX,{unique:!1}),i.createIndex(a.TIME_ADDED_INDEX,a.TIME_ADDED_INDEX,{unique:!1}),// Compound key index of product - timeAdded.
    i.createIndex(a.NAMESPACE_AND_TIME_ADDED_INDEX,["namespace","timeAdded"],{unique:!1})};try{return await (0,f.requestToPromise)(r),e(r.result)}catch(e){this.logger.warn("IndexedDB failed to initialise.",e),t(new d.default)}})),/*@__PURE__*/t(o)(this,"addItem",async(e,t={},r=a.GuardPolicy.ABANDON)=>{let{logger:i,namespace:s}=this,n=(0,f.convertToItemWrapper)(e,s,t),{objectStore:o}=await this.getObjectStoreAndTransaction("readwrite");if(r===a.GuardPolicy.IGNORE)throw new u.default(r,"IndexedDbConnector#addItem");try{if(!n.namespace||0===n.namespace.length||"string"!=typeof n.namespace)throw Error("Namespace not specified");// Making space for 1 event, if required.
let e=await this.globalEventLimitGuard.insertItems(o,[n],r);if(1===e.items.length)return{item:e.items[0],numberOfEvictedItems:e.numberOfEvictedItems};// Should never happen as the Policy and EventCountGuard should cause another pathway
throw Error(`Incorrect number of items added. Expected: 1, got: ${e.items.length}`)}catch(e){if((0,h.shouldIgnoreResilienceDbError)(e))throw e;throw i.log("Failed to add item to table",e),Error("Request to add item to table failed")}}),/*@__PURE__*/t(o)(this,"bulkAddItem",async(e,r=a.GuardPolicy.ABANDON)=>{let{logger:i,namespace:n}=this,o=e.map(e=>{let{item:r}=e,i=/*@__PURE__*/t(s)(e,m);return(0,f.convertToItemWrapper)(r,n,i)}),{objectStore:c}=await this.getObjectStoreAndTransaction("readwrite");try{return await this.globalEventLimitGuard.insertItems(c,o,r)}catch(e){if((0,h.shouldIgnoreResilienceDbError)(e))throw e;throw i.log("Failed to add item to table",e),Error("Request to add item to table failed")}}),/*@__PURE__*/t(o)(this,"getItems",async(e=c.GET_ITEM_COUNT)=>{let r=e>0?e:c.GET_ITEM_COUNT,{logger:i}=this,s=this.options.maxAttempts,{transaction:n,objectStore:l}=await this.getObjectStoreAndTransaction("readwrite"),u=l.index(a.TIME_TO_PROCESS_AFTER_INDEX),d=IDBKeyRange.upperBound(Date.now()),h=u.openCursor(d),p=await new Promise(async(e,n)=>{let a=[],l=0;h.onerror=e=>{i.error("Failed to open cursor:",e),n("Failed to open cursor")},// Requests for Cursors call onsuccess multiple times and cannot be converted to promises
h.onsuccess=n=>{let u=n.target.result;if(u){// Prevent mutation of the value we are returning
let n=function(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?g(Object(i),!0).forEach(function(r){/*@__PURE__*/t(o)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({},u.value);a.push(n);// Mutations seem to be required for testing indexeddb library
let d=u.value;if(d.retryAttempts+=1,d.timeToBeProcessedAfter=Date.now()+c.VISIBILITY_TIMEOUT,d.retryAttempts>=s){++l;let e=u.delete();(0,f.monitorErrorsOnRequest)(e,i)}else{let e=u.update(d);(0,f.monitorErrorsOnRequest)(e,i)}a.length<r?u.continue():e({items:a,numberOfDeletedItems:l})}else e({items:a,numberOfDeletedItems:l})}});return await (0,f.commitTransaction)(n,this.logger),p}),/*@__PURE__*/t(o)(this,"deleteItems",async e=>{let{transaction:t,objectStore:r}=await this.getObjectStoreAndTransaction("readwrite");try{let i=e.map(e=>this.deleteItem(r,e));await (0,f.commitTransaction)(t,this.logger),await Promise.all(i)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),/*@__PURE__*/t(o)(this,"getItemCount",async()=>{let{transaction:e,objectStore:t}=await this.getObjectStoreAndTransaction("readonly"),r=t.index(a.TIME_TO_PROCESS_AFTER_INDEX),i=IDBKeyRange.upperBound(Date.now()),s=r.count(i),n=await (0,f.requestToPromise)(s);return await (0,f.commitTransaction)(e,this.logger),n.target.result}),/*@__PURE__*/t(o)(this,"processItems",async(e,r=c.GET_ITEM_COUNT)=>{let i=await this.getItems(r),{items:n}=i,o=/*@__PURE__*/t(s)(i,y);try{let t=await e(n,o),r=n.map(e=>e.id);return(// We should not await this delete as a rejected promise would get caught by the catch statement
await this.deleteItems(r),t)}catch(e){// Eventually we will need a intermediate class to catch all errors but we should ignore this error
// This allows libraries beneath to distinguish between a success or failure in processing to update schedulers or anything else
// To provide back off or any other mechanism to allow what ever is cauing the errors to recover
throw new l.default(e)}}),/*@__PURE__*/t(o)(this,"deleteItem",async(e,t)=>{let{logger:r}=this;try{await (0,f.requestToPromise)(e.delete(t))}catch(e){throw r.error("Failed to delete item:",t,e),e}}),/*@__PURE__*/t(o)(this,"getObjectStoreAndTransaction",async e=>{let t=(await this.db).transaction(a.RESILIENCE_STORE_NAME,e),r=t.objectStore(a.RESILIENCE_STORE_NAME);return{transaction:t,objectStore:r}}),this.options=(0,f.createOptionsWithDefaults)(r),this.namespace=e,this.logger=this.options.logger,!window.indexedDB)throw new d.default;this.db=this.startDB(),// We just swallow any errors as we know that these are intermittent errors
// when switching from indexeddb -> localStorage
this.db.catch(()=>{}),/**
     *
     * This class will enforce the number of analytics events we can store in our IndexedDB object store
     * if asked before adding items to the object store.
     */this.globalEventLimitGuard=new p.default(this.options.maxEventLimit,this.namespace,this.logger,this.deleteItem)}storeType(){return a.StoreType.INDEXEDDB}}}),o("a3tO3",function(t,r){e(t.exports,"GET_ITEM_COUNT",()=>i),e(t.exports,"VISIBILITY_TIMEOUT",()=>s),e(t.exports,"MAX_ATTEMPTS",()=>n),e(t.exports,"EVENT_COUNT_LIMIT",()=>o);let i=7,s=6e4,n=10,o=5e3}),o("4HWNf",function(r,i){e(r.exports,"default",()=>l);var s=n("i5ijL"),o=n("dlqat"),a=n("9MDAj"),c=n("2xqEu");class l{constructor(e,r,i,n){if(/*@__PURE__*/t(s)(this,"deleteOldestNEvents",async(e,t)=>{var r;let i=e.index(o.NAMESPACE_AND_TIME_ADDED_INDEX),s=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),n=i.getAllKeys(s,t),a=await (0,c.requestToPromise)(n),l=null==a||null===(r=a.target)||void 0===r?void 0:r.result;// Adding extra safety
if(l&&Array.isArray(l)&&l.length>0)try{let t=l.map(t=>this.deleteItemHandler(e,t));await Promise.all(t)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),e>0)this.eventLimit=e;else throw Error("Event Limit has to be set higher than 1");this.namespace=r,this.logger=i,this.deleteItemHandler=n}/**
   * This function checks the number of events currently in AWC IndexedDB object store and if necessary,
   * will evict the oldest events in favour of the events we want to add.
   *
   * The indexed is treated as effectively: partitioned by product and sorted by timeAdded.
   *
   * This function can be re-used when the bulk add functionality is added in IndexedDbConnector.
   *
   * @param countOfEventsToAdd - The number of events we are proposing to add.
   */async insertItems(e,t,r=o.GuardPolicy.ABANDON){let i=[...t],s=0;switch(r){case o.GuardPolicy.ABANDON:await this.throwIfNotEnoughSpace(e,t.length);break;case o.GuardPolicy.EVICT:s=await this.evictIfNotEnoughSpace(e,t.length);break;case o.GuardPolicy.IGNORE:// Removed items from `itemsToAdd` if there is insufficient space
await this.calculateHowManyEventsWeCanAdd(e,i)}let n=i.map(t=>(0,c.requestToPromise)(e.add(t)));return await Promise.all(n),await (0,c.commitTransaction)(e.transaction,this.logger),{items:i,numberOfEvictedItems:s}}async throwIfNotEnoughSpace(e,t){let r=await this.calculateFreeSpace(e);if(r<t)throw new a.default(`Not enough space in IndexedDb. Needed ${t} but only had ${r}`)}async evictIfNotEnoughSpace(e,t){let r=await this.calculateFreeSpace(e);if(r<t){let i=t-r;return await this.deleteOldestNEvents(e,i),i}return 0}async calculateHowManyEventsWeCanAdd(e,t){let r=await this.calculateFreeSpace(e);if(r<t.length){let e=t.length-r,i=t.length-e;t.splice(i,e)}}async calculateFreeSpace(e){let t=await this.getCountofEventsInObjectStore(e);return this.eventLimit-t}/**
   * This query returns the count of items held in AWC IndexedDB object store per product.
   */async getCountofEventsInObjectStore(e){let t=e.index(o.NAMESPACE_AND_TIME_ADDED_INDEX),r=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),i=t.count(r),s=await (0,c.requestToPromise)(i);return s.target.result}}}),o("2xqEu",function(r,i){e(r.exports,"convertToItemWrapper",()=>a),e(r.exports,"createOptionsWithDefaults",()=>c),e(r.exports,"requestToPromise",()=>l),e(r.exports,"commitTransaction",()=>d),e(r.exports,"monitorErrorsOnRequest",()=>h);var s=n("dZz5i"),o=n("a3tO3");let a=(e,r,{id:i,retryAttempts:n,timeToProcessOffset:o})=>({item:e,id:i||/*@__PURE__*/t(s)(),retryAttempts:n||0,timeToBeProcessedAfter:Date.now()+(o||0),namespace:r,timeAdded:Date.now()}),c=e=>({logger:e.logger||console,useMemory:e.useMemory||!1,maxAttempts:e.maxAttempts||o.MAX_ATTEMPTS,// This is so that we can customise `maxEventLimit`, primarily for testing.
    maxEventLimit:e.maxEventLimit||o.EVENT_COUNT_LIMIT}),l=e=>new Promise((t,r)=>{e.onsuccess=e=>{t(e)},e.onerror=e=>{r(e)}}),u=e=>new Promise((t,r)=>{// We will have to see how much cost there is to waiting for the transaction to complete in the real world.
    // In theory in some cases we could return as soon as the request is complete and
    // just monitor errors on transactions with the logger.
    // This maybe more of an issue in Safari and other older browsers where commit isnt available
    // and we would have to wait for the transaction to complete itself.
    e.oncomplete=()=>{t()},e.onerror=e=>{r(e)},e.onabort=e=>{r(e)}}),d=(e,t)=>{try{"function"==typeof e.commit&&e.commit()}catch(e){throw t.error("Failed to force commit transaction:",e),e}return u(e)},h=(e,t)=>{e.onerror=e=>{t.warn("Error thrown from request:",e)}}}),o("d2Lvd",function(r,i){e(r.exports,"default",()=>y);var s=n("i5ijL"),o=n("ky31y"),a=n("dlqat"),c=n("a3tO3"),l=n("aPfNQ"),u=n("bMhih"),d=n("98T4R"),h=n("2xqEu");let p=["item"],f=["items"];function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}class y{constructor(e,t={}){this.namespace=e,this.memoryStore=[],this.options=(0,h.createOptionsWithDefaults)(t),/**
     * This class will enforce the number of analytics events we can store in our MemoryDb
     */this.globalEventLimitGuard=new d.default(this.options.maxEventLimit,{addItems:this.addItems.bind(this),getItemCount:this.getItemCount.bind(this),evictEventsIfNeeded:this.evictEventsIfNeeded.bind(this)})}/**
   * This method is used mainly to write new events to MemoryDB and uses the MEMORY_DB_GUARD_POLICY.EVICT_OLDEST_IF_LIMIT_EXECEEDED policy
   * to removes oldest events when limit is reached.
   */async addItem(e,t={},r=a.GuardPolicy.ABANDON){if(r===a.GuardPolicy.IGNORE)throw new u.default(r,"IndexedDbConnector#addItem");let i=(0,h.convertToItemWrapper)(e,this.namespace,t),s=await this.globalEventLimitGuard.insertItemsToMemoryStore([i],r);return Promise.resolve({item:s.items[0],numberOfEvictedItems:s.numberOfEvictedItems})}bulkAddItem(e,r=a.GuardPolicy.ABANDON){let i=e.map(e=>{let{item:r}=e,i=/*@__PURE__*/t(o)(e,p);return(0,h.convertToItemWrapper)(r,this.namespace,i)});return this.bulkAddItemWrapperType(i,r)}/**
   * This method is used mainly to write events to MemoryDB when unknown errors are thrown from IndexedDB.
   */bulkAddItemWrapperType(e,t=a.GuardPolicy.ABANDON){return Promise.resolve(this.globalEventLimitGuard.insertItemsToMemoryStore(e,t))}getItems(e=c.GET_ITEM_COUNT){return Promise.resolve(this.synchronousGetItems(e))}synchronousGetItems(e=c.GET_ITEM_COUNT){let r=e>0?e:c.GET_ITEM_COUNT,i=Date.now(),n=[],o=[];for(let e of this.memoryStore)if(e.timeToBeProcessedAfter<=i&&(n.push(function(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?m(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({},e)),// Mutates the item in the memoryStore array, but not whats inside of wrappedItems
e.timeToBeProcessedAfter+=c.VISIBILITY_TIMEOUT,e.retryAttempts+=1,e.retryAttempts>=this.options.maxAttempts&&o.push(e)),n.length>=r)break;return o.forEach(e=>{let t=this.memoryStore.indexOf(e);this.memoryStore.splice(t,1)}),{items:n,numberOfDeletedItems:o.length}}deleteItems(e){return this.memoryStore=this.memoryStore.filter(t=>!e.includes(t.id)),Promise.resolve(void 0)}getItemCount(){let e=Date.now(),t=this.memoryStore.filter(t=>t.timeToBeProcessedAfter<=e).length;return Promise.resolve(t)}async processItems(e,r){let i=this.synchronousGetItems(r),{items:s}=i,n=/*@__PURE__*/t(o)(i,f),a=s.map(e=>e.id);try{let t=await e(s,n);return await this.deleteItems(a),t}catch(e){throw new l.default(e)}}storeType(){return a.StoreType.MEMORY}/**
   * This function is adding items to the tail of the memoryStore and as it adds new items it keeps the
   * memory store sorted by timeAdded property. This makes evictions easier and adding elements to
   * memoryStore much faster.
   *
   * @param itemsToAdd
   */addItems(e){this.memoryStore.push(...e),// Sorting everytime, intentionally.
this.memoryStore.sort(function(e,t){return e.timeAdded-t.timeAdded})}/**
   * This function checks the number of events currently in AWC MemoryDb and if necessary,
   * will evict the oldest events in favour of the events we want to add.
   *
   * @param countOfEventsToAdd - The number of events we are proposing to add.
   */evictEventsIfNeeded(e){let t=this.memoryStore.length;// The number of analytics events currently in MemoryDb and
// the Z events we are proposing to add will exceed our event count limit.
if(t>e){let r=t-e;return(// Removing oldest M events
this.memoryStore.splice(0,r),r)}return 0}}}),o("98T4R",function(r,i){e(r.exports,"default",()=>c);var s=n("i5ijL"),o=n("dlqat"),a=n("9MDAj");class c{constructor(e,r){if(/*@__PURE__*/t(s)(this,"insertItemsToMemoryStore",(e,t)=>{switch(t){case o.GuardPolicy.ABANDON:return this.handleAbandonIfLimitWillExceedPolicy(e);case o.GuardPolicy.EVICT:return Promise.resolve(this.handleEvictOldestIfLimitExceededPolicy(e));case o.GuardPolicy.IGNORE:return this.handleAddAsManyAsPossible(e)}}),e>0)this.eventLimit=e;else throw Error("Event Limit has to be set higher than 1");this.memoryItemHandlers=r}async handleAbandonIfLimitWillExceedPolicy(e){let t=await this.memoryItemHandlers.getItemCount();if(t+e.length>this.eventLimit)throw new a.default(o.StoreType.MEMORY);return this.memoryItemHandlers.addItems(e),{items:e,numberOfEvictedItems:0}}handleEvictOldestIfLimitExceededPolicy(e){this.memoryItemHandlers.addItems(e);let t=this.memoryItemHandlers.evictEventsIfNeeded(this.eventLimit);return{items:e,numberOfEvictedItems:t}}async handleAddAsManyAsPossible(e){let t=this.eventLimit-await this.memoryItemHandlers.getItemCount(),r=t>e.length?e:e.slice(0,t);return this.memoryItemHandlers.addItems(r),{items:r,numberOfEvictedItems:0}}}}),o("h5nyR",function(r,i){e(r.exports,"default",()=>l);var s=n("i5ijL"),o=n("jULys");class a{constructor(){/*@__PURE__*/t(s)(this,"itemsDiscardedByRetry",0),/*@__PURE__*/t(s)(this,"eventCount",0),/*@__PURE__*/t(s)(this,"itemsDiscardedByOverflow",0),/*@__PURE__*/t(s)(this,"resilienceMechanism",o.ResilienceMechanism.INDEXEDDB),/*@__PURE__*/t(s)(this,"localstorageNumberOfQueuesPurged",0),/*@__PURE__*/t(s)(this,"localstorageNumberOfFullReclaims",0),/*@__PURE__*/t(s)(this,"localstorageNumberOfPartialReclaims",0),/*@__PURE__*/t(s)(this,"localstorageNumberOfFailedReclaims",0)}addToItemsDiscardedByRetryCounter(e=1){this.itemsDiscardedByRetry+=e}addToEventCount(){this.eventCount++}addToItemsDiscardedByOverflowCounter(e=1){this.itemsDiscardedByOverflow+=e}setResilienceMechanism(e){this.resilienceMechanism=e}/* <Localstorage specific> */addToReclaimMetrics(e){this.localstorageNumberOfFullReclaims+=e.fullReclaims,this.localstorageNumberOfPartialReclaims+=e.partialReclaims,this.localstorageNumberOfFailedReclaims+=e.failedReclaims}addToPurgedQueuesMetrics(e){this.localstorageNumberOfQueuesPurged+=e}/* </Localstorage specific> */subtractFromMetrics(e){this.itemsDiscardedByRetry=this.subtractFromCount(this.itemsDiscardedByRetry,e.itemsDiscardedByRetry),this.eventCount=this.subtractFromCount(this.eventCount,e.eventCount),this.itemsDiscardedByOverflow=this.subtractFromCount(this.itemsDiscardedByOverflow,e.itemsDiscardedByOverflow),// Localstorage specific
this.localstorageNumberOfFullReclaims=this.subtractFromCount(this.localstorageNumberOfFullReclaims,e.fullReclaims),this.localstorageNumberOfPartialReclaims=this.subtractFromCount(this.localstorageNumberOfPartialReclaims,e.partialReclaims),this.localstorageNumberOfFailedReclaims=this.subtractFromCount(this.localstorageNumberOfFailedReclaims,e.failedReclaims),this.localstorageNumberOfQueuesPurged=this.subtractFromCount(this.localstorageNumberOfQueuesPurged,e.localstorageQueuesPurged)}subtractFromCount(e,t){return Math.max(e-(t||0),0)}getMetricsPayload(){return{itemsDiscardedByRetry:this.itemsDiscardedByRetry,eventCount:this.eventCount,itemsDiscardedByOverflow:this.itemsDiscardedByOverflow,resilienceMechanism:this.resilienceMechanism,// Localstorage specific
localstorageQueuesPurged:this.localstorageNumberOfQueuesPurged,fullReclaims:this.localstorageNumberOfFullReclaims,partialReclaims:this.localstorageNumberOfPartialReclaims,failedReclaims:this.localstorageNumberOfFailedReclaims}}}let c=null;var l=()=>(c||(c=new a),c)}),o("jULys",function(t,r){var i,s;e(t.exports,"ResilienceMechanism",()=>n),e(t.exports,"NetworkStatusEnum",()=>o);let n=((i={}).INDEXEDDB="indexeddb",i.MEMORY="memory",i),o=((s={})[s.ONLINE=0]="ONLINE",s[s.OFFLINE=1]="OFFLINE",s)}),o("iSw2l",function(t,r){e(t.exports,"default",()=>s);var i=n("jULys");class s{constructor(e){window.addEventListener("offline",()=>e(i.NetworkStatusEnum.OFFLINE)),window.addEventListener("online",()=>e(i.NetworkStatusEnum.ONLINE))}getNetworkStatus(){return window.navigator.onLine?i.NetworkStatusEnum.ONLINE:i.NetworkStatusEnum.OFFLINE}}}),o("dqWO8",function(r,i){e(r.exports,"default",()=>d);var s,o=n("i5ijL"),a=n("hn8N0"),c=n("6Eahj");let l={minRetryDelay:1e3,maxRetryDelay:3e4,backoffFactor:2,backoffJitterPercentage:0,waitInterval:500,callbackTimeoutPeriod:5e3},u=((s={})[s.NONE=0]="NONE",s[s.IMMEDIATE=1]="IMMEDIATE",s[s.WAIT=2]="WAIT",s);class d{constructor(e,r){/*@__PURE__*/t(o)(this,"schedule",({immediate:e}={immediate:!1})=>{this.operationInFlight?e?this.queuedSchedule=u.IMMEDIATE:this.queuedSchedule!==u.IMMEDIATE&&(this.queuedSchedule=u.WAIT):(e||this.options.waitInterval<=0)&&0===this.failureCount?(this.clearTimeout(),this.run()):this.failureCount>0&&null===this.scheduledTimeout?this.scheduledTimeout=window.setTimeout(this.run,this.calculateBackoff()):null===this.scheduledTimeout&&(this.scheduledTimeout=window.setTimeout(this.run,this.options.waitInterval))}),/*@__PURE__*/t(o)(this,"stop",()=>{this.clearTimeout(),this.queuedSchedule=u.NONE}),/*@__PURE__*/t(o)(this,"getFailureCount",()=>this.failureCount),/*@__PURE__*/t(o)(this,"getCallbackStatus",()=>this.callbackTimer.getCallbackStatus()),/*@__PURE__*/t(o)(this,"clearTimeout",()=>{null!==this.scheduledTimeout&&(window.clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null)}),/*@__PURE__*/t(o)(this,"run",()=>{this.operationInFlight=!0,this.clearTimeout();try{this.callbackTimer.executeCallbackWithTimeout(this.callback,this.done,()=>this.done(c.DoneState.ERROR))}catch(e){this.done(e)}}),/*@__PURE__*/t(o)(this,"done",e=>{this.operationInFlight=!1,e===c.DoneState.ERROR||this.callbackTimer.getCallbackStatus()===a.CallbackStatus.TIMED_OUT?(this.failureCount++,this.clearTimeout()):e===c.DoneState.SUCCESS&&(this.failureCount=0),this.processQueuedSchedule()}),/*@__PURE__*/t(o)(this,"processQueuedSchedule",()=>{if(this.queuedSchedule!==u.NONE){let e=this.queuedSchedule===u.IMMEDIATE;this.queuedSchedule=u.NONE,this.schedule({immediate:e})}else this.failureCount>0&&// For example, when this.callback(this._done) was not called within
// this.callbackTimeoutPeriod
this.schedule()}),/*@__PURE__*/t(o)(this,"calculateBackoff",()=>{let{minRetryDelay:e,maxRetryDelay:t,backoffFactor:r,backoffJitterPercentage:i}=this.options,s=e*r**this.failureCount;if(i){let e=Math.random(),t=Math.floor(e*i*s);5>Math.floor(10*e)?s-=t:s+=t}return Number(Math.min(s,t).toPrecision(1))}),this.options={minRetryDelay:e.minRetryDelay||l.minRetryDelay,maxRetryDelay:e.maxRetryDelay||l.maxRetryDelay,backoffFactor:e.backoffFactor||l.backoffFactor,backoffJitterPercentage:e.backoffJitterPercentage||l.backoffJitterPercentage,waitInterval:void 0!==e.waitInterval?e.waitInterval:l.waitInterval,callbackTimeoutPeriod:e.callbackTimeoutPeriod||l.callbackTimeoutPeriod},this.scheduledTimeout=null,this.failureCount=0,this.callback=r,this.operationInFlight=!1,this.queuedSchedule=u.NONE,this.callbackTimer=new a.CallbackWithTimeout(this.options.callbackTimeoutPeriod)}}}),o("hn8N0",function(r,i){e(r.exports,"CallbackStatus",()=>c),e(r.exports,"CallbackWithTimeout",()=>u);var s,o,a=n("i5ijL");let c=((s={}).IDLE="idle",s.RUNNING="running",s.COMPLETED="completed",s.TIMED_OUT="timedOut",s),l=((o={}).EXECUTE="execute",o.COMPLETE="complete",o.TIMEOUT="timeout",o);class u{constructor(e){if(/*@__PURE__*/t(a)(this,"timeoutHandle",void 0),/*@__PURE__*/t(a)(this,"callbackStatus",c.IDLE),e>0){this.timeoutPeriod=e;return}throw Error("CallbackWithTimeout requires timeout period higher than 0")}// This is a state machine to control the flow of execution.
// IDLE -> RUNNING -> COMPLETED
// IDLE -> RUNNING -> TIMEDOUT
transitionCallbackStatus(e,t){switch(e){case c.IDLE:case c.TIMED_OUT:case c.COMPLETED:t===l.EXECUTE&&(this.callbackStatus=c.RUNNING);break;case c.RUNNING:switch(t){case l.COMPLETE:this.callbackStatus=c.COMPLETED;break;case l.TIMEOUT:this.callbackStatus=c.TIMED_OUT}break;default:this.callbackStatus=e}}// Start a timeout. If this.callback(this._done) does not finish
// by this.options.callbackTimeoutPeriod time period,
// we will call done with a true value.
executeCallbackWithTimeout(e,t,r){this.transitionCallbackStatus(this.callbackStatus,l.EXECUTE),// Setting timeout
this.timeoutHandle=window.setTimeout(()=>{this.transitionCallbackStatus(this.callbackStatus,l.TIMEOUT),r()},this.timeoutPeriod),// Executing callback
e(e=>{this.cancelTimeout(),this.getCallbackStatus()!==c.TIMED_OUT&&(this.transitionCallbackStatus(this.callbackStatus,l.COMPLETE),t(e))})}getCallbackStatus(){return this.callbackStatus}// This allows us to cancel the timeout function, for example, if the callback finishes before the timeout period
// or, if the user wants to manually cancel the timeout
cancelTimeout(){this.timeoutPeriod>0&&this.timeoutHandle&&(window.clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}}}),o("6Eahj",function(t,r){var i;e(t.exports,"DoneState",()=>s);// Clients can optionally provide the callbackTimeoutPeriod parameter
let s=((i={})[i.NOOP=0]="NOOP",i[i.SUCCESS=1]="SUCCESS",i[i.ERROR=2]="ERROR",i)}),o("7nZf6",function(r,i){e(r.exports,"attachXidToMultipleEvents",()=>l);var s=n("i5ijL"),o=n("6VXco");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function c(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?a(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}async function l(e,t){try{let r=await t;return e.map(e=>(function(e,t){if(!(t&&t instanceof Function))return e;if(e.msg.type===o.SegmentEventTypes.PAGE||e.msg.type===o.SegmentEventTypes.TRACK){let r=t();r&&Array.isArray(r)&&(e.msg.properties=c(c({},e.msg.properties),{},{xid:r}))}else if(e.msg.traits&&e.msg.type===o.SegmentEventTypes.IDENTIFY){let r=t();r&&Array.isArray(r)&&(e.msg.traits=c(c({},e.msg.traits),{},{xid:r}))}return e})(e,r))}catch(t){return e}}}),o("6VXco",function(t,r){var i;e(t.exports,"SegmentEventTypes",()=>s);// Segment event types copied from our backend
// https://bitbucket.org/atlassian/analytics-service/src/master/api/src/main/java/com/atlassian/dataservices/analytics/service/api/segment/
let s=((i={}).IDENTIFY="identify",i.PAGE="page",i.TRACK="track",i)}),o("cD5hU",function(t,r){e(t.exports,"DEFAULT_REQUEST_TIMEOUT",()=>i);let i=1e4;// 10 seconds
}),o("4oyDX",function(r,i){e(r.exports,"sendEvents",()=>c);var s=n("i5ijL"),o=n("gnX9A");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}let c=async e=>{var r;let i=null===(r=l(e))||void 0===r?void 0:r.signal,n=u(e.url),o=await fetch(e.url,function(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?a(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({method:"POST",// Content-type has to be text/plain in order to prevent unnecessary `OPTIONS` requests.
headers:{"Content-Type":"text/plain"},body:JSON.stringify(e.batch),signal:i},n));if(429===o.status||o.status>=500&&o.status<600)throw Error(`HTTP Error ${o.status} (${o.statusText})`);return o},l=e=>{if(e.abortController)return e.abortController;if(e.timeout){let t=new AbortController;return(// After a fetch has completed, calling abort is ignored.
setTimeout(()=>{t.abort()},e.timeout),t)}},u=(0,o.default)(e=>{let t=new URL(e).origin;return t===location.origin?{}:{mode:"cors",credentials:"include"}})}),o("f8NTQ",function(r,i){e(r.exports,"default",()=>p);var s=n("dIs5t"),o=n("dZz5i"),a=n("47mAC"),c=n("5N0fY");let l="ajs_anonymous_id",u="SAFE",d="UNSAFE",h="LOCAL_STORAGE";class p{constructor(){this.store=new c.default({useStoragePrefix:!1}),this.cookie=new a.default}getUserId(){return this.userId||null}setUserId(e){this.userId=e}getAnonymousId(e){/**
     * Prefer localStorage as there cant be duplicate keys, and its faster. Also update cookie, if stale.
     * If not set in localStorage, check cookies. Also set localStorage for future attempts.
     * If not in cookies, generate a new one. Set both cookie and localStorage keys.
     */return this.getAnonymousIdFromLocalStorageAndUpdateCookieIfStale()||this.getAnonymousIdFromCookieAndUpdateLocalStorage()||this.generateNewAnonymousId(e)}setAnonymousId(e){let t=JSON.stringify(e);return this.cookie.set(l,t),this.lastAnonymousIdCookieUpdate=Date.now(),this.store.setItem(l,t)}getAnonymousIdFromStorage(e){let t=e===h?this.store.getItem(l):this.cookie.get(l);if(t){let e={type:d,anonymousId:t};try{let r=JSON.parse(t);if(r&&"string"==typeof r)return{type:u,anonymousId:r};return e}catch(t){/*
         * Segments new Analytics-next client will store strings as strings without stringifing.
         * The legacy Segment client and AWC always stringify and parse cookies and values.
         * If the new Segment analytics-client stores a cookie and local storage value first, it will
         * breaking old clients.
         *
         * Additionally, JSON.parse can cause exceptions to be thrown in some browsers; see AAP-324.
         *
         * Intentionally swalling errors here and returning the original value found in storage to avoid ping-pong.
         */return e}}return{type:"NOT_FOUND"}}getAnonymousIdFromLocalStorageAndUpdateCookieIfStale(){let e=this.getAnonymousIdFromStorage(h),t=!1;switch((!this.lastAnonymousIdCookieUpdate||(0,s.default)(new Date,new Date(this.lastAnonymousIdCookieUpdate))>=7)&&(t=!0),e.type){case u:return t&&this.setAnonymousId(e.anonymousId),e.anonymousId;case d:return e.anonymousId;default:return null}}getAnonymousIdFromCookieAndUpdateLocalStorage(){let e=this.getAnonymousIdFromStorage("COOKIE");switch(e.type){case u:case d:return this.store.setItem(l,JSON.stringify(e.anonymousId)),e.anonymousId;default:return null}}generateNewAnonymousId(e=/*@__PURE__*/t(o)){let r=e();return this.setAnonymousId(r),r}}}),o("dIs5t",function(t,r){e(t.exports,"default",()=>c);var i=n("6GYne"),s=n("87mdt"),o=n("i5xNl");// for accurate equality comparisons of UTC timestamps that end up
// having the same representation in local time, e.g. one hour before
// DST ends vs. the instant that DST ends.
function a(e,t){var r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}function c(e,t){(0,o.default)(2,arguments);var r=(0,i.default)(e),n=(0,i.default)(t),c=a(r,n),l=Math.abs((0,s.default)(r,n));r.setDate(r.getDate()-c*l);// Math.abs(diff in full days - diff in calendar days) === 1 if last calendar day is not full
// If so, result must be decreased by 1 in absolute value
var u=Number(a(r,n)===-c),d=c*(l-u);return 0===d?0:d}}),o("47mAC",function(r,i){e(r.exports,"default",()=>h);var s=n("i5ijL"),o=n("aTuAR"),a=n("gdAXf"),c=n("33Qyg"),l=n("g3B9Q");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function d(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?u(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}class h{constructor(){this.cookieLike=(0,l.canUseCookie)()?/*@__PURE__*/t(o):new c.default}set(e,t,r){return this.cookieLike.set(e,t,d(d({},a.COOKIE_OPTIONS),{},{// Function is memoized so we only calculate this once per page load
domain:(0,l.getTld)()},r))}get(e){return this.cookieLike.get(e)}remove(e,t){this.cookieLike.remove(e,d({},t))}}}),o("aTuAR",function(e,t){var r;r=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(i){function s(){}function n(t,r,n){if("undefined"!=typeof document){"number"==typeof(n=e({path:"/"},s.defaults,n)).expires&&(n.expires=new Date(new Date*1+864e5*n.expires)),// We're using "expires" because "max-age" is not supported by IE
n.expires=n.expires?n.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=i.write?i.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in n)n[c]&&(a+="; "+c,!0!==n[c]&&// Considers RFC 6265 section 5.2:
// ...
// 3.  If the remaining unparsed-attributes contains a %x3B (";")
//     character:
// Consume the characters of the unparsed-attributes up to,
// not including, the first %x3B (";") character.
// ...
(a+="="+n[c].split(";")[0]));return document.cookie=t+"="+r+a}}function o(e,r){if("undefined"!=typeof document){for(var s={},n=document.cookie?document.cookie.split("; "):[],o=0;o<n.length;o++){var a=n[o].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(a[0]);if(c=(i.read||i)(c,l)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(s[l]=c,e===l)break}catch(e){}}return e?s[e]:s}}return s.set=n,s.get=function(e){return o(e,!1)},s.getJSON=function(e){return o(e,!0)},s.remove=function(t,r){n(t,"",e(r,{expires:-1}))},s.defaults={},s.withConverter=r,s}(function(){})},"function"==typeof define&&define.amd&&define(r),e.exports=r()}),o("gdAXf",function(t,r){e(t.exports,"COOKIE_OPTIONS",()=>i);let i={// 1 year
expires:365,secure:"https:"===window.location.protocol,path:"/"}}),o("33Qyg",function(t,r){e(t.exports,"default",()=>s);var i=n("5N0fY");class s{constructor(){this.safeStorage=new i.default({useStoragePrefix:!1})}set(e,t){return this.safeStorage.setItem(e,t),t}get(e){let t=this.safeStorage.getItem(e);return t||void 0}remove(e){this.safeStorage.removeItem(e)}}}),o("5N0fY",function(t,r){e(t.exports,"default",()=>o);var i=n("kkl0B"),s=n("6UwPD");class o extends s.default{constructor(e){let t;try{t=window.localStorage||i.default}catch(e){t=i.default}super(t,e)}}}),o("kkl0B",function(r,i){e(r.exports,"default",()=>o);var s=n("i5ijL"),o=new class{constructor(){/*@__PURE__*/t(s)(this,"_data",{}),/*@__PURE__*/t(s)(this,"length",0),/*@__PURE__*/t(s)(this,"setItem",(e,t)=>(this._data[e]=t,this.length=Object.keys(this._data).length,t)),/*@__PURE__*/t(s)(this,"getItem",e=>e in this._data?this._data[e]:null),/*@__PURE__*/t(s)(this,"removeItem",e=>(e in this._data&&delete this._data[e],this.length=Object.keys(this._data).length,null)),/*@__PURE__*/t(s)(this,"clear",()=>{this._data={},this.length=0}),/*@__PURE__*/t(s)(this,"key",e=>Object.keys(this._data)[e])}}}),o("6UwPD",function(r,i){e(r.exports,"default",()=>u);var s=n("i5ijL"),o=n("hKBww"),a=n("kkl0B");let c="awcInMemoryStorageFallback";function l(e){let t="test_value";if(!e)return!1;try{let r="awc.storage.support";e.setItem(r,t);let i=e.getItem(r);// handle localStorage silently failing
return e.removeItem(r),i===t}catch(e){// Can throw if localStorage is disabled
return!1}}class u{constructor(e,r={}){/*@__PURE__*/t(s)(this,"getStore",()=>this._store),/*@__PURE__*/t(s)(this,"getItem",e=>this._store.getItem(this.createKey(e))),/*@__PURE__*/t(s)(this,"removeItem",e=>this._store.removeItem(this.createKey(e))),/*@__PURE__*/t(s)(this,"setItem",(e,t)=>{try{this._store.setItem(this.createKey(e),t)}catch(r){(function(e){let t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:// Firefox
"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else -2147024882===e.number&&(t=!0);return t})(r)&&(this.swapToInMemory(),this._store.setItem(this.createKey(e),t))}}),/*@__PURE__*/t(s)(this,"swapToInMemory",()=>{let e;if(this._store===a.default)return;let t=Object.keys(this._store||{});l(window[c])?e=window[c]:(e=a.default,window[c]||// We need to do this because if there are multiple instances of Analytics Client in multiple scopes,
// there is no way to guarantee the throttling behaviour of the UI viewed event across those instances without a global singleton
(window[c]=a.default)),t.forEach(t=>{if(0===t.indexOf(this.getPrefix())){let r=this._store.getItem(t);r&&e.setItem(t,r)}}),this._store=e}),/*@__PURE__*/t(s)(this,"clear",()=>this._store.clear()),/*@__PURE__*/t(s)(this,"key",e=>this._store.key(e)),/*@__PURE__*/t(s)(this,"getPrefix",()=>this._prefix),/*@__PURE__*/t(s)(this,"createKey",e=>this._prefix?`${this.getPrefix()}.${e}`:e),this.options=r;let i=[];(void 0===r.useStoragePrefix||r.useStoragePrefix)&&i.push("awc"),r.envPrefix&&r.envPrefix!==o.envType.PROD&&i.push(r.envPrefix),this._prefix=i.join("-"),l(e)?this._store=e:this.swapToInMemory()}}}),o("g3B9Q",function(r,i){e(r.exports,"canUseCookie",()=>a),e(r.exports,"getTld",()=>u);var s=n("aTuAR"),o=n("gnX9A");let a=()=>!("file:"===location.protocol||"chrome-extension:"===location.protocol),c="__awc_tld_test__",l="tld_test",u=(0,o.default)(()=>{let{hostname:e}=location,r=e.split(".");for(let e=1;e<=r.length;e++){let i=r.slice(-1*e),n=`.${i.join(".")}`;if(/*@__PURE__*/t(s).set(c,l,{domain:n}),/*@__PURE__*/t(s).get(c)===l)return /*@__PURE__*/t(s).remove(c,{domain:n}),n}return e})}),o("7qddY",function(r,i){e(r.exports,"buildContext",()=>l),e(r.exports,"prepareEventProperties",()=>u);var s=n("i5ijL"),o=n("71NiU");function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function c(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?a(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let l=e=>c(c({},e.context),{},{userAgent:navigator.userAgent}),u=e=>{let r=d(e);return /*@__PURE__*/t(o)(r)},d=e=>{if(null===e||"object"!=typeof e)return e;let t={};return Object.keys(e).forEach(r=>{let i=h(e,r);void 0!==i&&(Array.isArray(i)?t[r]=i.map(e=>d(e)):"object"==typeof i&&null!==i?t[r]=d(i):t[r]=i)}),t},h=(e,t)=>e[t]}),o("71NiU",function(e,t){var r=n("26NTL");/**
 * Expose `traverse`.
 */e.exports=/**
 * Recursively traverse an object or array, and convert
 * all ISO date strings parse into Date objects.
 *
 * @param {Object} input - object, array, or string to convert
 * @param {Boolean} strict - only convert strings with year, month, and date
 * @return {Object}
 */function e(t,i){var s,n;return(void 0===i&&(i=!0),t&&"object"==typeof t)?(s=i,Object.keys(t).forEach(function(r){t[r]=e(t[r],s)}),t):Array.isArray(t)?(n=i,t.forEach(function(r,i){t[i]=e(r,n)}),t):r.is(t,i)?r.parse(t):t}}),o("26NTL",function(t,r){e(t.exports,"parse",()=>i,e=>i=e),e(t.exports,"is",()=>s,e=>s=e);/**
 * Matcher, slightly modified from:
 *
 * https://github.com/csnover/js-iso8601/blob/lax/iso8601.js
 */var i,s,n=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;i=function(e){var t=[1,5,6,7,11,12],r=n.exec(e),i=0;// fallback to native parsing
if(!r)return new Date(e);/* eslint-disable no-cond-assign */// remove undefined values
for(var s,o=0;s=t[o];o++)r[s]=parseInt(r[s],10)||0;/* eslint-enable no-cond-assign */// allow undefined days and months
r[2]=parseInt(r[2],10)||1,r[3]=parseInt(r[3],10)||1,// month is 0-11
r[2]--,// allow abitrary sub-second precision
r[8]=r[8]?(r[8]+"00").substring(0,3):0," "===r[4]?i=new Date().getTimezoneOffset():"Z"!==r[9]&&r[10]&&(i=60*r[11]+r[12],"+"===r[10]&&(i=0-i));var a=Date.UTC(r[1],r[2],r[3],r[5],r[6]+i,r[7],r[8]);return new Date(a)},s=function(e,t){return"string"==typeof e&&(!t||!1!==/^\d{4}-\d{2}-\d{2}/.test(e))&&n.test(e)}}),o("bzD9k",function(r,i){e(r.exports,"default",()=>c);var s=n("i5ijL"),o=n("hKBww"),a=n("9KrVO");class c{constructor(){/*@__PURE__*/t(s)(this,"handleOriginParameters",(e,t)=>{// Collect all the parameter labels to be handled
let r=Object.keys(e);if(!(r.length>0))throw Error("Empty parameter mapping provided");// Check if the parameter labels are valid. If any invalid labels are found throw an exception.
let i=r.filter(e=>0>Object.values(o.originTracingType).indexOf(e));if(i.length>0)throw Error(`Invalid Origin Tracing Parameter(s) supplied: ${i.join()}!`);// Capture and remove params from URL
let s=(0,a.default)((e,t)=>r.indexOf(t)>=0,t),n=Object.keys(s).map(t=>{let r=e[t](s[t]);return{[t]:r}}).reduce((e,t)=>Object.assign(e,t),{});return n}),this._originStore={}}}}),o("9KrVO",function(t,r){e(t.exports,"defaultHistoryReplaceFn",()=>o),e(t.exports,"default",()=>a);var i=n("fgIST"),s=n("gt0iD");let o=e=>window.history.replaceState({},"",e);var a=(e,t=o)=>{// Extract target parameters and values from URL if present
let r=window.location.href,n=window.location.hash,a=""!==n?r.replace(n,""):r,{url:c,query:l}=(0,i.parseUrl)(a),u=(0,s.pickBy)(l,e);// Do not modify URL if no matches
if(Object.keys(u).length>0){let r=(0,s.omitBy)(l,e);// Replace the URL minus captured parameters
if(Object.keys(r).length>0){let e=`${c}?${(0,i.stringify)(r)}${n}`;t(e)}else t(`${c}${n}`)}return u}}),o("fgIST",function(t,r){e(t.exports,"extract",()=>i,e=>i=e),e(t.exports,"parse",()=>s,e=>s=e),e(t.exports,"stringify",()=>o,e=>o=e),e(t.exports,"parseUrl",()=>a,e=>a=e),e(t.exports,"stringifyUrl",()=>c,e=>c=e),e(t.exports,"pick",()=>l,e=>l=e);var i,s,o,a,c,l,u=n("amu0k"),d=n("aeyPj"),h=n("bauwc"),p=n("49sXm");let f=e=>null==e,m=Symbol("encodeFragmentIdentifier");function y(e){if("string"!=typeof e||1!==e.length)throw TypeError("arrayFormatSeparator must be single character string")}function g(e,t){return t.encode?t.strict?u(e):encodeURIComponent(e):e}function v(e,t){return t.decode?d(e):e}function I(e){let t=e.indexOf("#");return -1!==t&&(e=e.slice(0,t)),e}function b(e){e=I(e);let t=e.indexOf("?");return -1===t?"":e.slice(t+1)}function E(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):t.parseBooleans&&null!==e&&("true"===e.toLowerCase()||"false"===e.toLowerCase())&&(e="true"===e.toLowerCase()),e}function O(e,t){y((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);let r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,i)=>{if(t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),!t){i[e]=r;return}void 0===i[e]&&(i[e]={}),i[e][t[1]]=r};case"bracket":return(e,r,i)=>{if(t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),!t){i[e]=r;return}if(void 0===i[e]){i[e]=[r];return}i[e]=[].concat(i[e],r)};case"colon-list-separator":return(e,r,i)=>{if(t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),!t){i[e]=r;return}if(void 0===i[e]){i[e]=[r];return}i[e]=[].concat(i[e],r)};case"comma":case"separator":return(t,r,i)=>{let s="string"==typeof r&&r.includes(e.arrayFormatSeparator),n="string"==typeof r&&!s&&v(r,e).includes(e.arrayFormatSeparator);r=n?v(r,e):r;let o=s||n?r.split(e.arrayFormatSeparator).map(t=>v(t,e)):null===r?r:v(r,e);i[t]=o};case"bracket-separator":return(t,r,i)=>{let s=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!s){i[t]=r?v(r,e):r;return}let n=null===r?[]:r.split(e.arrayFormatSeparator).map(t=>v(t,e));if(void 0===i[t]){i[t]=n;return}i[t]=[].concat(i[t],n)};default:return(e,t,r)=>{if(void 0===r[e]){r[e]=t;return}r[e]=[].concat(r[e],t)}}}(t),i=Object.create(null);if("string"!=typeof e||!(e=e.trim().replace(/^[?#&]/,"")))return i;for(let s of e.split("&")){if(""===s)continue;let[e,n]=h(t.decode?s.replace(/\+/g," "):s,"=");// Missing `=` should be `null`:
// http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters
n=void 0===n?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?n:v(n,t),r(v(e,t),n,i)}for(let e of Object.keys(i)){let r=i[e];if("object"==typeof r&&null!==r)for(let e of Object.keys(r))r[e]=E(r[e],t);else i[e]=E(r,t)}return!1===t.sort?i:(!0===t.sort?Object.keys(i).sort():Object.keys(i).sort(t.sort)).reduce((e,t)=>{let r=i[t];return r&&"object"==typeof r&&!Array.isArray(r)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(r):e[t]=r,e},Object.create(null))}i=b,s=O,o=(e,t)=>{if(!e)return"";y((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);let r=r=>t.skipNull&&f(e[r])||t.skipEmptyString&&""===e[r],i=function(e){switch(e.arrayFormat){case"index":return t=>(r,i)=>{let s=r.length;return void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?r:null===i?[...r,[g(t,e),"[",s,"]"].join("")]:[...r,[g(t,e),"[",g(s,e),"]=",g(i,e)].join("")]};case"bracket":return t=>(r,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?r:null===i?[...r,[g(t,e),"[]"].join("")]:[...r,[g(t,e),"[]=",g(i,e)].join("")];case"colon-list-separator":return t=>(r,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?r:null===i?[...r,[g(t,e),":list="].join("")]:[...r,[g(t,e),":list=",g(i,e)].join("")];case"comma":case"separator":case"bracket-separator":{let t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(i,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?i:(// Translate null to an empty string so that it doesn't serialize as 'null'
        s=null===s?"":s,0===i.length)?[[g(r,e),t,g(s,e)].join("")]:[[i,g(s,e)].join(e.arrayFormatSeparator)]}default:return t=>(r,i)=>void 0===i||e.skipNull&&null===i||e.skipEmptyString&&""===i?r:null===i?[...r,g(t,e)]:[...r,[g(t,e),"=",g(i,e)].join("")]}}(t),s={};for(let t of Object.keys(e))r(t)||(s[t]=e[t]);let n=Object.keys(s);return!1!==t.sort&&n.sort(t.sort),n.map(r=>{let s=e[r];return void 0===s?"":null===s?g(r,t):Array.isArray(s)?0===s.length&&"bracket-separator"===t.arrayFormat?g(r,t)+"[]":s.reduce(i(r),[]).join("&"):g(r,t)+"="+g(s,t)}).filter(e=>e.length>0).join("&")},a=(e,t)=>{t=Object.assign({decode:!0},t);let[r,i]=h(e,"#");return Object.assign({url:r.split("?")[0]||"",query:O(b(e),t)},t&&t.parseFragmentIdentifier&&i?{fragmentIdentifier:v(i,t)}:{})},c=(e,t)=>{t=Object.assign({encode:!0,strict:!0,[m]:!0},t);let r=I(e.url).split("?")[0]||"",n=i(e.url),a=s(n,{sort:!1}),c=Object.assign(a,e.query),l=o(c,t);l&&(l=`?${l}`);let u=function(e){let t="",r=e.indexOf("#");return -1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(u=`#${t[m]?g(e.fragmentIdentifier,t):e.fragmentIdentifier}`),`${r}${l}${u}`},l=(e,t,r)=>{r=Object.assign({parseFragmentIdentifier:!0,[m]:!1},r);let{url:i,query:s,fragmentIdentifier:n}=a(e,r);return c({url:i,query:p(s,t),fragmentIdentifier:n},r)}}),o("amu0k",function(e,t){e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)}),o("aeyPj",function(e,t){var r="%[a-f0-9]{2}",i=RegExp("("+r+")|([^%]+?)","gi"),s=RegExp("("+r+")+","gi");e.exports=function(e){if("string"!=typeof e)throw TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{// Try the built in decoder first
return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){// Fallback to a more advanced decoder
return function(e){for(// Keep track of all the replacements and prefill the map with the `BOM`
var t={"%FE%FF":"","%FF%FE":""},r=s.exec(e);r;){try{// Decode as big chunks as possible
t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=function(e){try{return decodeURIComponent(e)}catch(s){for(var t=e.match(i)||[],r=1;r<t.length;r++)t=(e=(function e(t,r){try{// Try to decode the entire string first
return[decodeURIComponent(t.join(""))]}catch(e){// Do nothing
}if(1===t.length)return t;r=r||1;// Split the array in 2 parts
var i=t.slice(0,r),s=t.slice(r);return Array.prototype.concat.call([],e(i),e(s))})(t,r).join("")).match(i)||[];return e}}(r[0]);n!==r[0]&&(t[r[0]]=n)}r=s.exec(e)}// Add `%C2` at the end of the map to make sure it does not replace the combinator before everything else
t["%C2"]="";for(var o=Object.keys(t),a=0;a<o.length;a++){// Replace all decoded components
var c=o[a];e=e.replace(RegExp(c,"g"),t[c])}return e}(e)}}}),o("bauwc",function(e,t){e.exports=(e,t)=>{if(!("string"==typeof e&&"string"==typeof t))throw TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];let r=e.indexOf(t);return -1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}}),o("49sXm",function(e,t){e.exports=function(e,t){for(var r={},i=Object.keys(e),s=Array.isArray(t),n=0;n<i.length;n++){var o=i[n],a=e[o];(s?-1!==t.indexOf(o):t(o,a,e))&&(r[o]=a)}return r}}),o("hl9hC",function(r,i){e(r.exports,"default",()=>d);var s=n("i5ijL"),o=n("5N0fY");let a="session.id",c="session.expiry",l=/^\d+$/,u=()=>{};class d{constructor(e={}){/*@__PURE__*/t(s)(this,"_generateNewSessionId",()=>{let e=Date.now().toString();return this._safeLocalStorage.setItem(a,e),// COMMENTS-123 - When a new session starts, call the callback if it is given
this._onNewSessionStarted&&this._onNewSessionStarted(),e}),/*@__PURE__*/t(s)(this,"_updateSessionExpiry",()=>{let e=Date.now()+this._sessionExpiryTime;return this._safeLocalStorage.setItem(c,e.toString()),e}),/*@__PURE__*/t(s)(this,"_debouncedUpdateSessionExpiry",e=>{let{_updateSessionExpiry:t}=this;// If the current expiry is out of date by more than 10% of the expiry, update immediately
if(e<Date.now()+this._sessionExpiryDebounceThresholdPercentage*this._sessionExpiryTime)return t();this._sessionExpiryDebounceTimer&&clearTimeout(this._sessionExpiryDebounceTimer),// @ts-ignore Something wrong with our types... this is legit
this._sessionExpiryDebounceTimer=setTimeout(()=>{t()},this._sessionExpiryDebounce)}),this._sessionExpiryTime=e.sessionExpiryTime||18e5,this._sessionExpiryDebounce=e.sessionExpiryDebounce||5e3,this._sessionExpiryDebounceThresholdPercentage=e.sessionExpiryDebounceThresholdPercentage||.9,this._onNewSessionStarted=e.onNewSessionStarted?e.onNewSessionStarted:u,this._safeLocalStorage=new o.default}getCurrentSessionId(){let e=this._safeLocalStorage.getItem(a),t=parseInt(this._safeLocalStorage.getItem(c)||"0",10)||0;return(this._debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)||!l.test(e))?this._generateNewSessionId():e}}}),o("5t8ho",function(t,r){e(t.exports,"default",()=>o);var i=n("kkl0B"),s=n("6UwPD");class o extends s.default{constructor(e){let t;try{t=window.sessionStorage||i.default}catch(e){t=i.default}super(t,e)}}}),o("lRK9J",function(r,i){e(r.exports,"default",()=>l);var s=n("i5ijL"),o=n("dZz5i"),a=n("5t8ho");let c="tab.id";class l{constructor(){/*@__PURE__*/t(s)(this,"_generateNewTabId",()=>{let e=/*@__PURE__*/t(o)();return this._safeSessionStorage.setItem(c,e),e}),this._safeSessionStorage=new a.default}getCurrentTabId(){let e=this._safeSessionStorage.getItem(c);return e||(e=this._generateNewTabId()),e}}}),o("csiQo",function(r,i){e(r.exports,"default",()=>g);var s=n("i5ijL"),o=n("fgIST"),a=n("dZz5i"),c=n("hKBww"),l=n("gt0iD"),u=n("5t8ho"),d=n("9KrVO");function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function p(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?h(Object(i),!0).forEach(function(r){/*@__PURE__*/t(s)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let f="taskSessions",m="taskSessionsInit",y="awc.";class g{constructor(){/*@__PURE__*/t(s)(this,"_taskSessionsNotRecentlyInitialised",e=>null===this._safeSessionStorage.getItem(f)||null===this._safeSessionStorage.getItem(m)||parseInt(this._safeSessionStorage.getItem(m)||"0",10)<e-3e3),/*@__PURE__*/t(s)(this,"_removeTaskSessionPrefix",(e,t)=>t.split(y)[1]),/*@__PURE__*/t(s)(this,"_isTaskSessionQueryParam",(e,t)=>t.startsWith(y)),/*@__PURE__*/t(s)(this,"getAllTaskSessions",()=>{try{return JSON.parse(this._safeSessionStorage.getItem(f)||"")}catch(e){return{}}}),/*@__PURE__*/t(s)(this,"_writeToSessionStorage",e=>{try{this._safeSessionStorage.setItem(f,JSON.stringify(e));// eslint-disable-next-line no-empty
}catch(e){}}),/*@__PURE__*/t(s)(this,"_appendTaskSessions",e=>{let t=this.getAllTaskSessions(),r=null===t?e:Object.assign(t,e);this._writeToSessionStorage(r)}),/*@__PURE__*/t(s)(this,"_safelyRemoveKey",(e,t)=>null===e?{}:(delete e[t],e)),/*@__PURE__*/t(s)(this,"createTaskSession",e=>{let r=/*@__PURE__*/t(a)(),i={};return i[e]=r,this._appendTaskSessions(i),r}),/*@__PURE__*/t(s)(this,"createTaskSessionWithProvidedId",(e,t)=>{if("string"!=typeof t)throw TypeError("invalid taskSessionId, must be string");let r={};r[e]=t,this._appendTaskSessions(r)}),/*@__PURE__*/t(s)(this,"completeTaskSession",e=>{let t=this.getAllTaskSessions(),r=this._safelyRemoveKey(t,e);this._writeToSessionStorage(r)}),/*@__PURE__*/t(s)(this,"formatTaskSessionQueryString",({uri:e,includedTaskSessions:t})=>{let{url:r,query:i}=(0,o.parseUrl)(e),s=this.getAllTaskSessions(),n=t?(0,l.pick)(s,t):(0,l.omit)(s,Object.values(c.originTracingType));if(0===Object.keys(n).length)return e;let a=p(p({},(0,l.mapKeys)(n,(e,t)=>y+t)),i);return`${r}?${(0,o.stringify)(a)}`}),/*@__PURE__*/t(s)(this,"stripQueryParameters",()=>{let e=(0,l.mapKeys)((0,d.default)(this._isTaskSessionQueryParam),this._removeTaskSessionPrefix);this._appendTaskSessions(e)});let e=Date.now();this._safeSessionStorage=new u.default;// Wrapping all sessionStorage calls in try catch to stop any error propogation, taskSessions should gracefully fail.
try{this._taskSessionsNotRecentlyInitialised(e)&&(this._writeToSessionStorage({}),this._safeSessionStorage.setItem(m,e.toString()));// eslint-disable-next-line no-empty
}catch(e){}}}}),o("9EU5K",function(r,i){e(r.exports,"default",()=>u);var s=n("i5ijL"),o=n("aTuAR");let a="atlassian_analytics_debug",c="synthetic",l=()=>{try{return JSON.parse(/*@__PURE__*/t(o).get(a)||"false")}catch(e){/*@__PURE__*/t(o).remove(a)}return!1};var u=class{constructor(){/*@__PURE__*/t(s)(this,"_bind",()=>{window.testAnalytics||(window.testAnalytics={eventCache:[],events:()=>window.testAnalytics.eventCache,clear:()=>{window.testAnalytics.eventCache=[];try{localStorage.removeItem("awc.ui.viewed.last.sent"),localStorage.removeItem("awc-staging.ui.viewed.last.sent"),localStorage.removeItem("awc-dev.ui.viewed.last.sent"),localStorage.removeItem("awc-local.ui.viewed.last.sent")}catch(e){// Ignore errors from localStorage.
}}})}),/*@__PURE__*/t(s)(this,"_cache",e=>{window.testAnalytics.eventCache.length>=100&&(window.testAnalytics.eventCache=window.testAnalytics.eventCache.slice(1,window.testAnalytics.eventCache.length)),window.testAnalytics.eventCache.push(e)}),/*@__PURE__*/t(s)(this,"_shouldCacheEvent",()=>this._isDebugCookieEnabled),/*@__PURE__*/t(s)(this,"saveEvent",e=>{e&&this._shouldCacheEvent()&&(window.testAnalytics||this._bind(),e.tags instanceof Array?e.tags.push(c):e.tags=[c],this._cache(e))}),this._isDebugCookieEnabled=l(),this._isDebugCookieEnabled&&this._bind()}}}),o("9Vwtv",function(r,i){e(r.exports,"default",()=>h);var s=n("ky31y"),o=n("i5ijL"),a=n("hKBww"),c=n("5N0fY");let l=["embeddedProduct"];function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function d(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?u(Object(i),!0).forEach(function(r){/*@__PURE__*/t(o)(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}class h{constructor(e,r,i,n={}){if(/*@__PURE__*/t(o)(this,"start",()=>{this._startInterval(),this._bindEventListeners()}),/*@__PURE__*/t(o)(this,"stop",()=>{this._stopInterval(),this._unbindEventListeners()}),/*@__PURE__*/t(o)(this,"resetTimers",()=>{this._intervalId&&(this.stop(),this.start())}),/*@__PURE__*/t(o)(this,"_bindEventListeners",()=>{window.addEventListener("focus",this._focusListener),window.addEventListener("blur",this._blurListener)}),/*@__PURE__*/t(o)(this,"_unbindEventListeners",()=>{window.removeEventListener("focus",this._focusListener),window.removeEventListener("blur",this._blurListener)}),/*@__PURE__*/t(o)(this,"_startInterval",()=>{clearInterval(this._intervalId),this._intervalId=setInterval(this._handleInterval,this._delay)}),/*@__PURE__*/t(o)(this,"_stopInterval",()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}),/*@__PURE__*/t(o)(this,"_getProductKey",(e,t)=>{let r=e;return t&&(r+=`-${t}`),r}),/*@__PURE__*/t(o)(this,"_getLastSentTimestamp",(e,t,r)=>{let i=this._parseLocalStorageData()||{},s=i[r]||{},n=s[t]||{},o=n[e]||null;return o}),/*@__PURE__*/t(o)(this,"_parseLocalStorageData",()=>{let e=this._safeLocalStorage.getItem(this._storageKey);try{return JSON.parse(e||"")}catch(e){return this._safeLocalStorage.removeItem(this._storageKey),null}}),/*@__PURE__*/t(o)(this,"_setLastSentTimestamp",(e,t,r)=>{let i=this._parseLocalStorageData()||{},s=i[r]||{},n=s[t]||{};n[e]=Date.now(),s[t]=n,i[r]=s,this._safeLocalStorage.setItem(this._storageKey,JSON.stringify(i))}),/*@__PURE__*/t(o)(this,"_shouldSendEvent",(e,t,r,i)=>{if(!document.hasFocus()||t!==a.tenantType.NONE&&!r||!i)return!1;let s=Date.now()-this._getLastSentTimestamp(e,r,i);return s>this._throttle}),/*@__PURE__*/t(o)(this,"_handleInterval",()=>{let e=this._getContext(),{embeddedProduct:r}=e,i=/*@__PURE__*/t(s)(e,l);this._sendEvent(this._product,i),r&&this._sendEvent(r,i,!0)}),/*@__PURE__*/t(o)(this,"_sendEvent",(e,t,r=!1)=>{let{subproduct:i,tenantIdType:s,tenantId:n,userId:o,lastScreenEvent:a,attributes:c}=t,l=this._getProductKey(e,i);if(this._shouldSendEvent(l,s,n,o)){this._setLastSentTimestamp(l,n,o);let t=this._createEvent(e,i,r,a,c);this._onEvent(t)}}),/*@__PURE__*/t(o)(this,"_createEvent",(e,t,r,i,s)=>{let n={product:e,source:"ui",action:"viewed",actionSubject:"ui",attributes:s};return r&&(// Clear the subproduct and version as they don't relate to the embedded product
n.subproduct=null,n.version=null,n.attributes=d(d({},n.attributes),{},{embeddedInEnv:this._productInfo.env,embeddedInProduct:this._productInfo.product,embeddedInSubproduct:t,embeddedInVersion:this._productInfo.version,embeddedInOrigin:this._productInfo.origin,embeddedInPlatform:this._productInfo.platform})),i&&(n.attributes=d(d({},n.attributes),{},{lastScreenEvent:{name:i.name,attributes:i.attributes}})),n}),!e)throw Error("Missing productInfo");if(!e.product)throw Error("Missing productInfo.product");if(!r)throw Error("Missing getContext callback");if("function"!=typeof r)throw Error("Invalid getContext, must be function");if(!i)throw Error("Missing onEvent callback");if("function"!=typeof i)throw Error("Invalid onEvent, must be function");this._productInfo=e,this._product=e.product,this._getContext=r,this._onEvent=i,this._delay=n.delay||2e3,this._throttle=n.throttle||36e5,this._storageKey=n.storageKey||"ui.viewed.last.sent",this._safeLocalStorage=new c.default({envPrefix:this._productInfo.env}),this._focusListener=()=>{this._startInterval()},this._blurListener=()=>{this._stopInterval()}}}}),o("9U1aK",function(t,r){e(t.exports,"default",()=>i);function i(e,t){return e&&"function"==typeof e?()=>{e(t)}:null}}),o("krz7b",function(t,r){e(t.exports,"XIDPromise",()=>s);var i=n("5ZmuD");let s=(e,t)=>{if(e&&t&&"function"==typeof t)return Promise.race([t().catch(()=>()=>(0,i.createUnknownXid)()),new Promise(e=>{setTimeout(()=>e(()=>(0,i.createTimeoutXid)()),i.XID_TIMEOUT)})])}}),o("5ZmuD",function(t,r){e(t.exports,"XID_TIMEOUT",()=>s),e(t.exports,"createTimeoutXid",()=>o),e(t.exports,"createUnknownXid",()=>a);var i=n("59Y64");let s=5e3,o=()=>[{type:i.XIDItemType.XC,state:"TIMEOUT"},{type:i.XIDItemType.UID,state:"TIMEOUT"}],a=()=>[{type:i.XIDItemType.XC,state:"UNKNOWN"},{type:i.XIDItemType.UID,state:"UNKNOWN"}]}),o("59Y64",function(t,r){var i;e(t.exports,"XIDItemType",()=>s);let s=((i={}).XC="xc",i.UID="uid",i)});//# sourceMappingURL=settings.d6e42496.js.map

//# sourceMappingURL=settings.d6e42496.js.map
