function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t=globalThis,r={},a={},n=t.parcelRequired932;null==n&&((n=function(e){if(e in r)return r[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},t.parcelRequired932=n);var o=n.register;o("3H44p",function(t,r){e(t.exports,"i18nSettings",()=>a);let a={defaultLocale:"en",supportedLocales:["cs","de","en","es","fi","fr","hu","it","ja","nb","nl","pl","pt-BR","ru","sv","th","tr","uk","vi","zh-Hans","zh-Hant"],resourceUrl:"./strings/{locale}.25412506.json"}}),o("inPtb",function(t,r){e(t.exports,"dataForUrl",()=>u),e(t.exports,"getMe",()=>p),e(t.exports,"sendCard",()=>d),e(t.exports,"getMembers",()=>m),e(t.exports,"getStars",()=>f),e(t.exports,"remind",()=>g),e(t.exports,"searchMessages",()=>h),e(t.exports,"getAlertsForBoard",()=>y),e(t.exports,"createAlert",()=>b),e(t.exports,"updateAlert",()=>w),e(t.exports,"deleteAlert",()=>k),e(t.exports,"getTrelloMember",()=>_),e(t.exports,"preAuth",()=>x),e(t.exports,"getSlackUserConversations",()=>v);var a=n("8SRUg"),o=n("Icjk4");let{sha256Digest:l}=window.TrelloPowerUp.util.crypto,i={401:a.slackErrors.Unauthorized,403:a.slackErrors.Forbidden,404:a.slackErrors.NotFound,422:a.slackErrors.UnprocessableEntity,500:a.slackErrors.ServerError},s=(e,t)=>new(i[e]||a.slackErrors.Unknown)(t);async function c(e,t,r={},a=!1){let n=await (0,o.tokenHelpers).getToken(e);try{let l=await window.fetch(t,{...r,headers:{Authorization:n,"Content-Type":"application/json","X-Trello-Workspace-Id":e.getContext().organization,...r?.headers}});if(l.ok){let e=l.headers.get("content-type")?.includes("application/json");return e?l.json():l.text()}if(403===l.status&&!a)return await (0,o.tokenHelpers).resetToken(e),c(e,t,r,!0);throw s(l.status,await l.text()||l.statusText)}catch(r){let e;try{e=JSON.parse(r.message)?.error}catch{e={message:r.message}}// Extend error object with the response from server
throw(// eslint-disable-next-line no-console
console.error(`Failed request "${t}"`,e),Object.assign(r,e))}}async function u(e,t,r){if(r)try{let e=await l(t),r=window.localStorage.get(`slack:url:${e}`);if(r)return{formatted:r}}catch(e){// no luck, that's fine
}return await c(e,`/api/power-up/details-for-url?${new URLSearchParams({url:t,one:String(r)})}`)}async function p(e){try{return await c(e,"/api/power-up/members/me")}catch(e){return(// eslint-disable-next-line no-console
console.error("Failed to call getMe",e),[])}}async function d(e,t,r,a){return c(e,`/api/power-up/send/${t}`,{method:"POST",body:JSON.stringify({idSlackTeam:r,idTarget:a})})}async function m(e,t){return c(e,`/api/power-up/slack/${t}/members`)}async function f(e,t){return c(e,`/api/power-up/slack/${t}/stars`)}async function g(e,t,r,a,n){return c(e,`/api/power-up/remind/${t}`,{method:"POST",body:JSON.stringify({idSlackTeam:r,message:a,time:n})})}async function h(e,t,r){return c(e,`/api/power-up/search/${t}?${new URLSearchParams({query:r})}`)}function y(e,t){return c(e,`/api/power-up/alerts/board/${t}`)}async function b(e,t,r,a,n,o){return c(e,"/api/power-up/alerts",{method:"POST",body:JSON.stringify({idChannel:t,idSlackTeam:r,actionTypes:o,idBoard:a,idTrelloTeam:n})})}async function w(e,t,r){return c(e,`/api/power-up/alerts/${t}`,{method:"PUT",body:JSON.stringify({actionTypes:r})})}async function k(e,t){return c(e,`/api/power-up/alerts/${t}`,{method:"DELETE"})}async function _(e,t){try{let r=await c(e,`/api/power-up/members/${t}`);if(r)return r;return{fullName:"Unknown member"}}catch(e){return{fullName:"Unknown member"}}}async function x(e,t){return c(e,"/api/power-up/preauth",{method:"POST",body:JSON.stringify(t)})}async function v(e,t){let{conversations:r}=await c(e,`/api/power-up/slack/${t}/conversations`);return r}}),o("8SRUg",function(t,r){e(t.exports,"slackErrors",()=>a);let a=window.TrelloPowerUp.util.makeErrorEnum("Slack",["Unauthorized","InvalidChannel","InvalidMessage","NoText","NotFound","Forbidden","UnprocessableEntity","RateLimited","Unknown","InvalidResponse","ServerError"])}),o("Icjk4",function(t,r){e(t.exports,"tokenHelpers",()=>s);var a=n("e5i1Q");let o={name:"Trello Slack App",key:(0,a.getClientId)(),scope:"read,write,account"};async function l(e){try{let t=await e.requestToken(o);return(// eslint-disable-next-line no-console
console.log("Successfully reset token for Slack Power-Up"),e.set("member","private","trelloToken",t),t)}catch(e){// eslint-disable-next-line no-console
console.error("Error resetting token for Slack Power-Up",e)}}async function i(e){let t=await e.get("member","private","trelloToken");return t||l(e)}let s={getToken:i,resetToken:l}}),o("ipEe4",function(t,r){e(t.exports,"getUserDisplayName",()=>a);function a(e,t){return e?.profile?.real_name||e?.profile?.display_name||t?.localizeKey("unknown_member")||"Unknown"}}),o("1Bgkx",function(t,r){e(t.exports,"remindInInterval",()=>l);var a=n("inPtb"),o=n("ipEe4");let l=(e,t,r)=>n=>n.card("name","url").then(o=>{let l=r;/^(in|on|every)/.test(r)||(l=/minutes|hours|days|months/.test(r)?`in ${r}`:`on ${r}`);let i=n.localizeKey("check_on_card",{card:`*<${o.url}|${o.name}>*`});return a.remind(n,e.id,t.id,i,l)}).then(()=>{let t=n.localizeKey("slack_will_remind_name",{name:"me"===e.id?"you":e.name??(0,o.getUserDisplayName)(e)});return n.popup({title:n.localizeKey("reminder_set"),url:"app.html?page=reminder-set",args:{message:t,success:!0,target:e}})}).catch(t=>n.popup({title:n.localizeKey("unable_to_set_reminder"),url:"app.html?page=reminder-set",args:{message:n.localizeKey("error_setting_reminder",{error:t.message}),success:!1,target:e}}))}),o("i5ijL",function(e,t){var r=n("eCfpc");e.exports=function(e,t,a){return(t=r(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e},e.exports.__esModule=!0,e.exports.default=e.exports}),o("eCfpc",function(e,t){var r=n("81Rc9").default,a=n("fua09");e.exports=function(e){var t=a(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports}),o("81Rc9",function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),o("fua09",function(e,t){var r=n("81Rc9").default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==r(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports}),o("ky31y",function(e,t){var r=n("bmBti");e.exports=function(e,t){if(null==e)return{};var a,n,o=r(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o},e.exports.__esModule=!0,e.exports.default=e.exports}),o("bmBti",function(e,t){e.exports=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n},e.exports.__esModule=!0,e.exports.default=e.exports}),o("gnX9A",function(t,r){e(t.exports,"default",()=>o);var a=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function n(e,t){if(e.length!==t.length)return!1;for(var r,n,o=0;o<e.length;o++)if(!((r=e[o])===(n=t[o])||a(r)&&a(n)))return!1;return!0}function o(e,t){void 0===t&&(t=n);var r=null;function a(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];if(r&&r.lastThis===this&&t(a,r.lastArgs))return r.lastResult;var o=e.apply(this,a);return r={lastResult:o,lastArgs:a,lastThis:this},o}return a.clear=function(){r=null},a}}),o("6GYne",function(t,r){e(t.exports,"default",()=>l);var a=n("i5xNl");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){(0,a.default)(1,arguments);var t=Object.prototype.toString.call(e);// Clone the date
return e instanceof Date||"object"===o(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):(("string"==typeof e||"[object String]"===t)&&"undefined"!=typeof console&&(// eslint-disable-next-line no-console
console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(Error().stack)),new Date(NaN))}}),o("i5xNl",function(t,r){e(t.exports,"default",()=>a);function a(e,t){if(t.length<e)throw TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}}),o("87mdt",function(t,r){e(t.exports,"default",()=>i);var a=n("7r2lU"),o=n("bop02"),l=n("i5xNl");function i(e,t){(0,l.default)(2,arguments);var r=(0,o.default)(e),n=(0,o.default)(t);// because the number of milliseconds in a day is not constant
// (e.g. it's different in the day of the daylight saving time clock shift)
return Math.round((r.getTime()-(0,a.default)(r)-(n.getTime()-(0,a.default)(n)))/864e5)}}),o("7r2lU",function(t,r){e(t.exports,"default",()=>a);/**
 * Google Chrome as of 67.0.3396.87 introduced timezones with offset that includes seconds.
 * They usually appear for dates that denote time before the timezones were introduced
 * (e.g. for 'Europe/Prague' timezone the offset is GMT+00:57:44 before 1 October 1891
 * and GMT+01:00:00 after that date)
 *
 * Date#getTimezoneOffset returns the offset in minutes and would return 57 for the example above,
 * which would lead to incorrect calculations.
 *
 * This function returns the timezone offset in milliseconds that takes seconds in account.
 */function a(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}}),o("bop02",function(t,r){e(t.exports,"default",()=>l);var a=n("6GYne"),o=n("i5xNl");function l(e){(0,o.default)(1,arguments);var t=(0,a.default)(e);return t.setHours(0,0,0,0),t}});var l=n("hWx02"),i=n("e5i1Q"),s=n("3H44p"),c=n("LrxRf"),u=n("inPtb"),l=n("hWx02"),u=(n("inPtb"),n("inPtb"));const p=e=>async t=>{let r=await u.getMe(t);if(!r?.length)return t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:t=>t.get("board","private","selected-slack").then(r=>e(t,{id:r}))});let a=[...r.map(({team:r})=>({...r,text:r.name,callback:a=>t.set("board","private","selected-slack",r.id).then(()=>e(a,r))})),{text:"Add Slack Workspace",callback:t=>t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:t=>t.get("board","private","selected-slack").then(r=>e(t,{id:r}))}),alwaysVisible:!0}];return t.popup({items:a,title:t.localizeKey("choose_slack_workspace"),search:{count:15}})},d={},m={},f=e=>t=>Promise.all([t.get("board","private","selected-slack"),u.getMe(t)]).then(([r,a])=>{if(!a?.length)return t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:f(e)}),null;if(r){let e=a.find(({team:e})=>e.id===r);if(e)return e.team}return a[0].team}).then(r=>{if(!r)return null;if(d[r.id])return d[r.id];if(m[r.id])return Promise.resolve(t.popup({items:m[r.id],title:t.localizeKey("choose_a_channel"),search:{count:15,placeholder:t.localizeKey("search_for_a_channel"),empty:t.localizeKey("no_channels_found")}}));let a=Promise.all([u.getStars(t,r.id),u.getSlackUserConversations(t,r.id)]).then(([a,n])=>{let o=n.map(t=>({...t,text:`${t.isPrivate?"\uD83D\uDD12 ":"#"}${t.name}`,callback:a=>e(a,t,r)})).sort((e,t)=>{let r=a.find(t=>t.channel===e.id),n=a.find(e=>e.channel===t.id);return r&&!n?-1:!r&&n?1:e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0}),l={text:t.localizeKey("choose_a_different_workspace"),callback:p(f(e)),alwaysVisible:!0};return o.push(l),m[r.id]=o,d[r.id]=null,t.popup({items:o,title:t.localizeKey("choose_a_channel"),search:{count:15,placeholder:t.localizeKey("search_for_a_channel"),empty:t.localizeKey("no_channels_found")}})});return d[r.id]=a,a});var u=n("inPtb"),g=n("ipEe4");async function h(e){try{return await e.get("board","private","selected-slack")}catch(e){return}}const y=e=>async t=>{let[r,a]=await Promise.all([h(t),u.getMe(t)]);if(!a?.length)return t.popup({title:t.localizeKey("authorize"),url:"./app.html?page=authorization",callback:y(e)}),null;let n=r?a.find(({team:e})=>e.id===r):null,o=n?.team||a[0].team;if(!o)return null;let l=await u.getMembers(t,o.id),i=l.map(r=>({text:(0,g.getUserDisplayName)(r,t),callback:t=>e(t,r,o)})),s={text:t.localizeKey("choose_a_different_workspace"),callback:p(y(e)),alwaysVisible:!0};return i.push(s),t.popup({items:i,title:t.localizeKey("choose_user_ellipsis"),search:{count:15,placeholder:t.localizeKey("search_for_a_user"),empty:t.localizeKey("no_users_found")}})};var b=n("1Bgkx"),u=n("inPtb"),g=n("ipEe4");function w(e,t){(0,l.sendUIEvent)({action:"clicked",actionSubject:"button",actionSubjectId:t,source:"cardDetailScreen"},e)}async function k(e,t,r){let a=await e.card("id");try{await u.sendCard(e,a.id,r.id,t.id),(t.id.startsWith("C")||t.id.startsWith("G"))&&e.set("board","private","last-channel",{target:t,team:r}),e.popup({title:e.localizeKey("message_sent"),url:"app.html?page=message-sent",args:{target:t,team:r}})}catch(t){e.popup({title:e.localizeKey("unable_to_send_card"),url:"app.html?page=message-sent",args:{error:e.localizeKey("error_sending_card")}})}}const _=(e,t)=>r=>r.popup({title:r.localizeKey("choose_a_time"),url:"choose-time.html",args:{target:e,team:t}});function x(e,t,r){let a=e.localizeKeys(["three_minutes","ten_minutes","one_hour","three_hours","one_day","two_days","three_days","seven_days","fourteen_days","thirty_days"]);return e.popup({title:"me"===t.name?e.localizeKey("remind_you_when"):e.localizeKey("remind_name_when",{name:t.name??(0,g.getUserDisplayName)(t)}),items:[{text:e.localizeKey("choose_a_time_ellipsis"),callback:_(t,r)},...["3 minutes","10 minutes","1 hour","3 hours","1 day","2 days","3 days","7 days","14 days","30 days"].map((n,o)=>({text:e.localizeKey("remind_in_interval",{interval:a[o]}),callback:(0,b.remindInInterval)(t,r,`in ${n}`)}))]})}function v(e,t){return x(e,{name:"me",id:"me"},t)}async function S(e){let t=await e.get("board","private","last-channel");w(e,"slackPowerUpCardButton");let r=[t?.target?.name&&{text:e.localizeKey("send_to_specific_channel",{channel:t.target.name,isPrivate:t.target.isPrivate?"\uD83D\uDD12 ":"#"}),callback:r=>u.getMe(r).then(a=>a.some(({team:e})=>e.id===t.team.id)?k(r,t.target,t.team):r.popup({title:e.localizeKey("authorize"),url:"./app.html?page=authorization",callback:e=>e.back()}))},{text:e.localizeKey("send_to_channel"),callback:e=>(w(e,"slackPowerUpSendToChannelButton"),f(k)(e))},{text:e.localizeKey("send_via_direct_message"),callback:e=>(w(e,"slackPowerUpSendDMButton"),y(k)(e))},{text:e.localizeKey("attach_conversation_ellipsis"),callback:e=>(w(e,"slackPowerUpAttachConversationButton"),function(e){e.popup({title:e.localizeKey("attach_conversation"),url:"app.html?page=attach-conversation",height:504})}(e))},{text:e.localizeKey("remind_me_about_card"),callback:e=>(w(e,"slackPowerUpRemindMeButton"),p(v)(e))},{text:e.localizeKey("remind_someone_about_card"),callback:e=>(w(e,"slackPowerUpRemindSomeoneButton"),y(x)(e))},{text:e.localizeKey("remind_channel_about_card"),callback:e=>(w(e,"slackPowerUpRemindChannelButton"),f(x)(e))}].filter(Boolean);return e.popup({items:r,title:e.localizeKey("slack")})}var z=n("34WAt");function U(e,t){return e.length>t?`${e.slice(0,t).replace(/\s*\S+$/,"")}\u{2026}`:e}const T=window.outerHeight-200;function K(e){return"production"===i.environment?e:"staging"===i.environment?`${e} (stg-east)`:`${e} (${(void 0)??"unknown"})`}const P={accentColor:"#425381",url:"app.html?page=settings",title:K("Slack"),height:T>625?T:625},N=`https://${window.location.hostname}/power-up/images/icon.svg`,{sha256Digest:E}=window.TrelloPowerUp.util.crypto;function M(e){(0,l.sendUIEvent)({action:"clicked",actionSubject:"button",actionSubjectId:"slackPowerUpBoardButton",source:"boardScreen"},e),e.modal(P)}async function D(e,t){let{url:r}=t;if(!(0,z.slackUrls).isMessage(t.url))throw e.NotHandled("Not a Slack message URL");return u.dataForUrl(e,r,!0).catch(()=>{throw e.NotHandled("Error getting data for URL")}).then(t=>{if(t&&t.formatted)return{name:U(t.formatted,128),desc:t.formatted};if(t&&t.messages.length>0){let a=t.messages[0].text||t.messages[0].attachments[0].fallback;return(0,c.msgFormatter).getMessageText(e,a,t).then(async e=>{try{let t=await E(r);localStorage.setItem(`slack:url:${t}`,e)}catch(e){// we tried
}return{name:U(e,128),desc:e}}).catch(()=>{throw e.NotHandled("Error formatting message")})}throw e.NotHandled("No data for URL")})}async function $(e,t){if(!(0,z.slackUrls).isMessage(t.url))throw e.NotHandled("Not a Slack message URL");let r=/archives\/(.*)\//g.exec(t.url)[1];return/^[D|G]/g.test(r)?{text:t.url,icon:N}:u.dataForUrl(e,t.url,!0).catch(()=>{throw e.NotHandled("Error getting data for URL")}).then(r=>{if(r?.formatted)return{text:U(r.formatted,128),icon:N};if(r?.messages?.length){let a=r.messages[0].text||r.messages[0].attachments[0].fallback;return(0,c.msgFormatter).getMessageText(e,a,r).then(async e=>{try{let r=await E(t.url);localStorage.setItem(`slack:url:${r}`,e)}catch(e){// we tried
}return{text:U(e,128),icon:N}}).catch(()=>{throw e.NotHandled("Error formatting message")})}throw e.NotHandled("No data for URL")})}window.TrelloPowerUp.initialize({"attachment-sections":function(e,t){(0,l.sendUIEvent)({action:"viewed",actionSubject:"section",actionSubjectId:"slackPowerUpSection",source:"cardDetailScreen"},e);let r=t.entries.filter(e=>(0,z.slackUrls).isMessage(e.url));return r.length?[{claimed:r,icon:N,title:K(e.localizeKey("slack_conversations")),content:{type:"iframe",url:e.signUrl("./messages.html"),height:64}}]:[]},"board-buttons":function(e){return[{icon:N,text:K(e.localizeKey("slack")),callback:M}]},"card-buttons":function(e){return[{icon:N,text:K(e.localizeKey("slack")),callback:S}]},"card-from-url":D,"format-url":$,"show-settings":function(e){e.modal(P)}},{targetOrigin:(0,i.getTargetOrigin)(),localization:s.i18nSettings,Sentry:window.Sentry});//# sourceMappingURL=index.f5c467c2.js.map

//# sourceMappingURL=index.f5c467c2.js.map
